# í•™êµê¸‰ì‹ ì‹ì¬ë£Œ ë°ì´í„° {#sec-school-meal-analysis}

2024ë…„ ëŒ€í•œë¯¼êµ­ í•™êµê¸‰ì‹ì€ ì „ë¡€ ì—†ëŠ” ì˜ˆì‚° ìœ„ê¸°ì— ì§ë©´í•´ ìˆë‹¤. ì „êµ­ í‰ê·  ê¸‰ì‹ ë‹¨ê°€ëŠ” ì „ë…„ ëŒ€ë¹„ 213ì›(6%) ì¸ìƒëœ 3,664ì›ì„ ê¸°ë¡í–ˆì§€ë§Œ, ë¬¼ê°€ ìƒìŠ¹ë¥ ì„ ë”°ë¼ê°€ì§€ ëª»í•˜ëŠ” ì‹¤ì •ì´ë‹¤[@ë² ì´ë¹„ë‰´ìŠ¤2024]. ì§€ì—­ë³„ ê²©ì°¨ ë˜í•œ ì‹¬ê°í•œ ìˆ˜ì¤€ìœ¼ë¡œ, ì„œìš¸ ì´ˆë“±í•™êµ ê¸‰ì‹ë¹„ëŠ” 4,098ì›ì¸ ë°˜ë©´ ì „ë¶ì€ 3,390ì›ìœ¼ë¡œ 708ì›ì˜ ì°¨ì´ë¥¼ ë³´ì´ê³  ìˆë‹¤[@ë² ì´ë¹„ë‰´ìŠ¤2024]. ì´ëŸ¬í•œ ë¶ˆê· í˜•ì€ êµìœ¡ì¬ì •êµë¶€ê¸ˆ ì¶•ì†Œì™€ ë§ë¬¼ë ¤ ê° ì§€ì—­ êµìœ¡ì²­ì˜ ê¸‰ì‹ ìš´ì˜ì— í° ë¶€ë‹´ìœ¼ë¡œ ì‘ìš©í•˜ê³  ìˆë‹¤[@ëŒ€í•œê¸‰ì‹ì‹ ë¬¸2023].

í˜„ì¬ í•™êµê¸‰ì‹ í˜„ì¥ì´ ì§ë©´í•œ ë„ì „ê³¼ì œëŠ” ë‹¤ì¸µì ì´ë‹¤. ì£¼ìš” ë†ì¶•ìˆ˜ì‚°ë¬¼ì˜ ì§€ì†ì ì¸ ê°€ê²© ìƒìŠ¹, ì¹œí™˜ê²½ ì‹ì¬ë£Œ ì‚¬ìš© ì˜ë¬´í™”ì— ë”°ë¥¸ ì¶”ê°€ ë¹„ìš© ë¶€ë‹´, ê·¸ë¦¬ê³  ì¸ê±´ë¹„ì™€ ìš´ì˜ë¹„ì˜ ì¦ê°€ê°€ ë³µí•©ì ìœ¼ë¡œ ì‘ìš©í•˜ê³  ìˆë‹¤[@í•œêµ­ì€í–‰2024]. íŠ¹íˆ í•™êµê¸‰ì‹ì€ ì „ì²´ ì¹œí™˜ê²½ ë†ì‚°ë¬¼ ìœ í†µëŸ‰ì˜ 39%ë¥¼ ì†Œë¹„í•˜ëŠ” ìµœëŒ€ ì‹œì¥ì´ì§€ë§Œ[@ë†ì‹í’ˆë¶€2018], ì¼ë°˜ ë†ì‚°ë¬¼ ëŒ€ë¹„ ë†’ì€ ê°€ê²©ìœ¼ë¡œ ì¸í•´ ì˜ˆì‚° ì••ë°•ì„ ê°€ì¤‘ì‹œí‚¤ê³  ìˆë‹¤. ì´ëŸ¬í•œ ìƒí™©ì—ì„œ ê¸‰ì‹ì˜ ì§ˆì„ ìœ ì§€í•˜ë©´ì„œë„ ì˜ˆì‚° íš¨ìœ¨ì„±ì„ í™•ë³´í•˜ëŠ” ê²ƒì€ ì „êµ­ ëª¨ë“  êµìœ¡ì²­ì˜ ê³µí†µëœ ê³¼ì œê°€ ë˜ì—ˆë‹¤[@ì¶©ì²­ë‚¨ë„2024].

ì´ë²ˆ ì¥ì—ì„œëŠ” ë°ì´í„° ê¸°ë°˜ ì ‘ê·¼ì„ í†µí•´ í•™êµê¸‰ì‹ ì‹ì¬ë£Œ ì¡°ë‹¬ì˜ íš¨ìœ¨ì„± ê°œì„  ë°©ì•ˆì„ ëª¨ìƒ‰í•˜ê³ ì í•œë‹¤. ìœ í†µì±„ë„ë³„ ê°€ê²© ë¹„êµ, ì§€ì—­ë³„ ì¡°ë‹¬ íŒ¨í„´ ë¶„ì„, í•™êµê¸‰ë³„ ì†Œë¹„ íŠ¹ì„± íŒŒì•…ì„ í†µí•´ ì œí•œëœ ì˜ˆì‚°ìœ¼ë¡œ ìµœëŒ€ì˜ íš¨ê³¼ë¥¼ ì°½ì¶œí•  ìˆ˜ ìˆëŠ” ì „ëµì„ ì œì‹œí•  ê²ƒì´ë‹¤. ë‹¨ìˆœí•œ ë¹„ìš© ì ˆê°ì„ ë„˜ì–´ì„œ, ì§€ì† ê°€ëŠ¥í•œ í•™êµê¸‰ì‹ ìš´ì˜ ëª¨ë¸ êµ¬ì¶•ì„ ìœ„í•œ ì‹¤ì¦ì  ê·¼ê±°ë¥¼ ë§ˆë ¨í•˜ëŠ” ë° ê·¸ ëª©ì ì´ ìˆë‹¤.

```{r}
#| include: false
#| label: setup
# ê³µí†µ ì„¤ì • íŒŒì¼ ë¡œë“œ
source("_common.R")
```


## ë°ì´í„° ì‚¬ì „ {#sec-school-data-schema}

ì´ë²ˆ ì¥ì—ì„œ í™œìš©í•˜ëŠ” **ë†ì‚°ë¬¼ í•™êµê¸‰ì‹ ì‹ì¬ë£Œ ì†Œë¹„ í’ˆëª© ë°ì´í„°**ëŠ” ì „êµ­ í•™êµê¸‰ì‹ í˜„ì¥ì—ì„œ ë°œìƒí•˜ëŠ” ì‹¤ì œ ì‹ì¬ë£Œ ì¡°ë‹¬ í˜„í™©ì„ í¬ê´„ì ìœ¼ë¡œ ë‹´ê³  ìˆë‹¤. í•™êµê¸‰ì‹ì—ì„œ ì‚¬ìš©ë˜ëŠ” ì‹ì¬ë£ŒëŠ” ìˆ˜ë°± ê°€ì§€ì— ì´ë¥´ì§€ë§Œ, ë³¸ ì¥ì—ì„œëŠ” **ì°¹ìŒ€** í’ˆëª©ì— ì§‘ì¤‘í•˜ì—¬ ë¶„ì„ì„ ì§„í–‰í•œë‹¤. ì°¹ìŒ€ì€ í•œêµ­ ì „í†µ ìŒì‹ë¬¸í™”ì—ì„œ ì¤‘ìš”í•œ ìœ„ì¹˜ë¥¼ ì°¨ì§€í•˜ë©°, í•™êµê¸‰ì‹ì—ì„œë„ ì§€ì†ì ìœ¼ë¡œ ì†Œë¹„ë˜ëŠ” ëŒ€í‘œì ì¸ ê³¡ë¥˜ë¡œì„œ ìœ í†µì±„ë„ë³„ ì¡°ë‹¬ íŒ¨í„´ê³¼ ì§€ì—­ë³„ ì†Œë¹„ êµ¬ì¡°ë¥¼ ë¶„ì„í•˜ê¸°ì— ì í•©í•œ í’ˆëª©ì´ë‹¤.

ë°ì´í„°ì˜ í•µì‹¬ íŠ¹ì§•ì€ @fig-data-structure ì— ì œì‹œëœ ë°”ì™€ ê°™ì´ í•™êµê¸‰ë³„ ì„¸ë¶„í™”ëœ ì¸¡ì • ì²´ê³„ì— ìˆë‹¤. ìœ ì¹˜ì›ë¶€í„° ê³ ë“±í•™êµê¹Œì§€ ê° êµìœ¡ê³¼ì •ë³„ë¡œ ì¤‘ëŸ‰(KG)ê³¼ ê¸ˆì•¡(ì›) ë°ì´í„°ë¥¼ ë™ì‹œì— ì œê³µí•˜ë©°, ì¤‘í•™êµì™€ ê³ ë“±í•™êµì˜ ê²½ìš° ì„±ë³„ êµ¬ë¶„(ë‚¨/ì—¬/ë‚¨ë…€ê³µí•™)ê¹Œì§€ í¬í•¨í•œë‹¤. ë˜í•œ ìœ í†µì±„ë„ì€ ëŒ€í˜•ë§ˆíŠ¸, ì²´ì¸ìŠˆí¼, í¸ì˜ì , ì¼ë°˜ìŠˆí¼, ì§ê±°ë˜ë§ˆíŠ¸ë¡œ ì„¸ë¶„í™”ë˜ì–´ ìˆì–´, ì°¹ìŒ€ì´ë¼ëŠ” ë‹¨ì¼ í’ˆëª©ì—ì„œë„ ê° ì±„ë„ì˜ ê°€ê²© ê²½ìŸë ¥ê³¼ ì¡°ë‹¬ íš¨ìœ¨ì„±ì„ ì •ë°€í•˜ê²Œ ë¹„êµí•  ìˆ˜ ìˆë‹¤.

![í•™êµê¸‰ì‹ ì‹ì¬ë£Œ ë°ì´í„° êµ¬ì¡° ë° í•„ë“œ êµ¬ì„±](images/data_structure.svg){#fig-data-structure}

ì°¹ìŒ€ í’ˆëª©ì„ í†µí•œ ì´ëŸ¬í•œ ë¶„ì„ì€ í•™êµê¸‰ì‹ ì¡°ë‹¬ ì „ëµ ìˆ˜ë¦½ì— í•µì‹¬ì ì¸ ì‹œì‚¬ì ì„ ì œê³µí•œë‹¤. ìœ í†µì±„ë„ë³„ ë‹¨ê°€ ë¹„êµì™€ ì§€ì—­ë³„ ì¡°ë‹¬ íŒ¨í„´ ë¶„ì„ì„ í†µí•´ ë„ì¶œëœ íš¨ìœ¨ì„± ê°œì„  ë°©ì•ˆì€ ë‹¤ë¥¸ ì£¼ìš” ì‹ì¬ë£Œ í’ˆëª©ì—ë„ ì ìš© ê°€ëŠ¥í•œ ì¼ë°˜í™”ëœ ì›ì¹™ì„ ì œì‹œí•  ê²ƒì´ë‹¤. íŠ¹íˆ ì„±ë³„ êµ¬ë¶„ ë°ì´í„°ë¥¼ í™œìš©í•œ í•™êµ ìœ í˜•ë³„ ë§ì¶¤í˜• ê³µê¸‰ ì „ëµì€ ì œí•œëœ ê¸‰ì‹ ì˜ˆì‚°ì˜ íš¨ìœ¨ì„± ê·¹ëŒ€í™”ë¥¼ ìœ„í•œ êµ¬ì²´ì ì¸ ë°©ë²•ë¡ ì„ ì œê³µí•˜ë©°, í–¥í›„ ë‹¤ë¥¸ ê³¡ë¥˜ë‚˜ ì£¼ìš” ë¶€ì‹ì¬ë£Œë¡œ í™•ì¥ ì ìš©í•  ìˆ˜ ìˆëŠ” ë¶„ì„ í”„ë ˆì„ì›Œí¬ë¥¼ êµ¬ì¶•í•˜ëŠ” ë° ê¸°ì—¬í•  ê²ƒìœ¼ë¡œ ê¸°ëŒ€ëœë‹¤.

### ë°ì´í„° ê°œìš” {#sec-school-data-overview}

ë³¸ ë¶„ì„ì—ì„œ ì‚¬ìš©í•˜ëŠ” í•™êµê¸‰ì‹ ì‹ì¬ë£Œ ë°ì´í„°ëŠ” **ì°¹ìŒ€** í’ˆëª©ì— ëŒ€í•œ 2024ë…„ 1ì›” ì „êµ­ ìœ í†µ ë° ì†Œë¹„ í˜„í™©ì„ í¬í•¨í•©ë‹ˆë‹¤.

```{r}
#| label: load-schema
#| tbl-cap: "í•™êµê¸‰ì‹ ì‹ì¬ë£Œ ë°ì´í„° ìŠ¤í‚¤ë§ˆ"
# ìŠ¤í‚¤ë§ˆ ì •ë³´ ë¡œë“œ
schema_data <- read_csv("data/1_ìƒ˜í”Œ_ìŠ¤í‚¤ë§ˆ.csv", locale = locale(encoding = "UTF-8"))

schema_data %>%
  gt() %>%
  cols_width(
    ìˆœë²ˆ ~ pct(10),
    í•œê¸€ëª… ~ pct(20),
    ë°ì´í„°íƒ€ì… ~ pct(15),
    Nullí—ˆìš© ~ pct(10),
    ë°ì´í„°í•­ëª©ì„¤ëª… ~ pct(45)
  ) %>%
  tab_options(
    table.width = pct(100),
    table.font.size = px(12),
    column_labels.background.color = "#f8f9fa"
  ) %>%
  opt_table_font(
    font = "Apple Gothic"
  ) %>%
  tab_header(title = "í•™êµê¸‰ì‹ ì‹ì¬ë£Œ ë°ì´í„° ìŠ¤í‚¤ë§ˆ")
```

### ë°ì´í„° êµ¬ì¡° íŠ¹ì§• {#sec-school-data-structure}

```{r}
#| label: load-data
#| warning: false
# í•„ìš” íŒ¨í‚¤ì§€ ë¡œë“œ
library(lubridate)

# í•™êµê¸‰ì‹ ë°ì´í„° ë¡œë“œ
meal_data_raw <- read_csv("data/1_ìƒ˜í”Œ_(ê³ ìˆ˜ìš”ë°ì´í„°)_ë†ì‚°ë¬¼ í•™êµê¸‰ì‹ ì‹ì¬ë£Œ ì†Œë¹„ í’ˆëª© ë°ì´í„°.csv",
                          locale = locale(encoding = "UTF-8"))

# ë°ì´í„° ì „ì²˜ë¦¬: ë‚ ì§œ ë° ë²”ì£¼í˜• ë³€ìˆ˜ ì²˜ë¦¬
meal_data <- meal_data_raw %>%
  mutate(
    # ì›”ì½”ë“œ(M202401)ë¥¼ ë‚ ì§œí˜•ìœ¼ë¡œ ë³€í™˜
    ì›”ì½”ë“œ_ì›ë³¸ = ì›”ì½”ë“œ,
    ë…„ë„ = as.numeric(str_sub(ì›”ì½”ë“œ, 2, 5)),
    ì›” = as.numeric(str_sub(ì›”ì½”ë“œ, 6, 7)),
    ë‚ ì§œ = ymd(paste0(ë…„ë„, "-", sprintf("%02d", ì›”), "-01")),

    # ë²”ì£¼í˜• ë³€ìˆ˜ë¥¼ factorë¡œ ë³€í™˜
    ì¹´í…Œê³ ë¦¬ = factor(ì¹´í…Œê³ ë¦¬),
    ìœ í†µì±„ë„ = factor(ìœ í†µì±„ë„,
                   levels = c("ì‹ìì¬ë§ˆíŠ¸", "ì¼ë°˜ìŠˆí¼", "ì²´ì¸ìŠˆí¼", "ëŒ€í˜•ë§ˆíŠ¸", "í¸ì˜ì ")),
    ê´‘ì—­ì‹œë„ = factor(ê´‘ì—­ì‹œë„),

    # ì‹œê³„ì—´ ë¶„ì„ì„ ìœ„í•œ ì¶”ê°€ ë³€ìˆ˜
    ë¶„ê¸° = quarter(ë‚ ì§œ),
    ê³„ì ˆ = case_when(
      ì›” %in% c(12, 1, 2) ~ "ê²¨ìš¸",
      ì›” %in% c(3, 4, 5) ~ "ë´„",
      ì›” %in% c(6, 7, 8) ~ "ì—¬ë¦„",
      ì›” %in% c(9, 10, 11) ~ "ê°€ì„"
    ),
    ê³„ì ˆ = factor(ê³„ì ˆ, levels = c("ë´„", "ì—¬ë¦„", "ê°€ì„", "ê²¨ìš¸"))
  )

# ë°ì´í„° ê¸°ë³¸ ì •ë³´ ìš”ì•½í‘œ ìƒì„±
data_summary_info <- tribble(
  ~êµ¬ë¶„, ~í•­ëª©, ~ë‚´ìš©,
  "ğŸ“Š ë°ì´í„° ê·œëª¨", "ì´ ê´€ì¸¡ì¹˜", paste0(comma(nrow(meal_data)), " ê±´"),
  "ğŸ“Š ë°ì´í„° ê·œëª¨", "ì´ ë³€ìˆ˜", paste0(ncol(meal_data), " ê°œ"),
  "ğŸ“Š ë°ì´í„° ê·œëª¨", "ë¶„ì„ í’ˆëª©", levels(meal_data$ì¹´í…Œê³ ë¦¬),

  "ğŸ“… ì‹œê°„ ë²”ìœ„", "ë¶„ì„ ê¸°ê°„", paste0(format(min(meal_data$ë‚ ì§œ), "%Yë…„ %mì›”"), " ~ ", format(max(meal_data$ë‚ ì§œ), "%Yë…„ %mì›”")),
  "ğŸ“… ì‹œê°„ ë²”ìœ„", "ì‹œê³„ì—´ ë²”ìœ„", paste0(n_distinct(meal_data$ë‚ ì§œ), " ê°œì›”"),
  "ğŸ“… ì‹œê°„ ë²”ìœ„", "ê³„ì ˆ êµ¬ë¶„", paste(levels(meal_data$ê³„ì ˆ), collapse = ", "),

  "ğŸª ìœ í†µ êµ¬ì¡°", "ìœ í†µì±„ë„", paste(levels(meal_data$ìœ í†µì±„ë„), collapse = ", "),
  "ğŸª ìœ í†µ êµ¬ì¡°", "ê´‘ì—­ì‹œë„", paste0(n_distinct(meal_data$ê´‘ì—­ì‹œë„), " ê°œ ì§€ì—­"),
  "ğŸª ìœ í†µ êµ¬ì¡°", "ì†Œë§¤ë§¤ì¶œ ì´ì•¡", paste0(comma(round(sum(meal_data$ì†Œë§¤_ë§¤ì¶œì•¡_ì›, na.rm = TRUE)/1e8, 1)), " ì–µì›"),

  "ğŸš ê¸‰ì‹ êµ¬ì¡°", "í•™êµê¸‰ êµ¬ë¶„", "ìœ ì¹˜ì›, ì´ˆë“±í•™êµ, ì¤‘í•™êµ, ê³ ë“±í•™êµ",
  "ğŸš ê¸‰ì‹ êµ¬ì¡°", "ì„±ë³„ êµ¬ë¶„", "ë‚¨, ì—¬, ë‚¨ë…€ê³µí•™",
  "ğŸš ê¸‰ì‹ êµ¬ì¡°", "ê¸‰ì‹ ì´ëŸ‰", paste0(comma(round(sum(meal_data %>%
    select(starts_with("KG_")) %>%
    rowwise() %>%
    mutate(ì´_KG = sum(c_across(everything()), na.rm = TRUE)) %>%
    pull(ì´_KG), na.rm = TRUE))), " KG"),

  "âœ… ë°ì´í„° í’ˆì§ˆ", "ë°ì´í„° ì™„ì „ì„±", paste0(round((1 - sum(is.na(meal_data))/prod(dim(meal_data))) * 100, 1), "%"),
  "âœ… ë°ì´í„° í’ˆì§ˆ", "ì´ìƒì¹˜ ë¹„ìœ¨", paste0(round(sum(meal_data$ì†Œë§¤_ë§¤ì¶œì•¡_ì› < 0, na.rm = TRUE)/nrow(meal_data) * 100, 2), "%"),
  "âœ… ë°ì´í„° í’ˆì§ˆ", "ì¤‘ë³µ ê´€ì¸¡ì¹˜", paste0(nrow(meal_data) - nrow(distinct(meal_data)), " ê±´")
)

# GT í…Œì´ë¸”ë¡œ í‘œì‹œ
data_summary_info %>%
  gt() %>%
  # êµ¬ë¶„ë³„ë¡œ ê·¸ë£¹í™”
  tab_row_group(
    label = "ğŸ“Š ë°ì´í„° ê·œëª¨",
    rows = êµ¬ë¶„ == "ğŸ“Š ë°ì´í„° ê·œëª¨"
  ) %>%
  tab_row_group(
    label = "ğŸ“… ì‹œê°„ ë²”ìœ„",
    rows = êµ¬ë¶„ == "ğŸ“… ì‹œê°„ ë²”ìœ„"
  ) %>%
  tab_row_group(
    label = "ğŸª ìœ í†µ êµ¬ì¡°",
    rows = êµ¬ë¶„ == "ğŸª ìœ í†µ êµ¬ì¡°"
  ) %>%
  tab_row_group(
    label = "ğŸš ê¸‰ì‹ êµ¬ì¡°",
    rows = êµ¬ë¶„ == "ğŸš ê¸‰ì‹ êµ¬ì¡°"
  ) %>%
  tab_row_group(
    label = "âœ… ë°ì´í„° í’ˆì§ˆ",
    rows = êµ¬ë¶„ == "âœ… ë°ì´í„° í’ˆì§ˆ"
  ) %>%
  # ì»¬ëŸ¼ ì„¤ì •
  cols_hide(êµ¬ë¶„) %>%
  cols_width(
    í•­ëª© ~ pct(35),
    ë‚´ìš© ~ pct(65)
  ) %>%
  # ìŠ¤íƒ€ì¼ë§
  tab_options(
    table.width = pct(90),
    row_group.font.weight = "bold",
    row_group.background.color = "#E3F2FD",
    table.font.size = px(12)
  ) %>%
  opt_table_font(
    font = "Apple Gothic"
  ) %>%
  tab_header(
    title = "ğŸ“Š í•™êµê¸‰ì‹ ì‹ì¬ë£Œ ë°ì´í„° êµ¬ì¡° ìš”ì•½",
    subtitle = "ì°¹ìŒ€ í’ˆëª© ê¸°ì¤€ 2024ë…„ 1ì›” ë°ì´í„°"
  ) %>%
  # í–‰ ìŠ¤íƒ€ì¼ë§
  tab_style(
    style = cell_fill(color = "#F8F9FA"),
    locations = cells_body(rows = seq(2, nrow(data_summary_info), 2))
  ) %>%
  tab_style(
    style = cell_text(weight = "bold"),
    locations = cells_body(columns = í•­ëª©)
  )

```

## ë¶„ì„ ì„¤ê³„ ë° ì „ëµ {#sec-analysis-design}

### í•µì‹¬ ë¬¸ì œ ì •ì˜ {#sec-core-problems}

![ë¶„ì„ ì „ëµ í”„ë ˆì„ì›Œí¬](images/analysis_strategy.svg){#fig-analysis-strategy}

ë³¸ ë¶„ì„ì´ í•´ê²°í•˜ê³ ì í•˜ëŠ” **í•µì‹¬ ë¬¸ì œ**ëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤:

ğŸ“ˆ **ê¸‰ì‹ ì¡°ë‹¬ ë¹„ìš©ì˜ ì§€ì†ì  ì¦ê°€**ëŠ” ì „êµ­ ëª¨ë“  êµìœ¡ì²­ì´ ì§ë©´í•œ í•µì‹¬ ê³¼ì œë‹¤. ì „êµ­ í‰ê·  ê¸‰ì‹ ë‹¨ê°€ê°€ 213ì›(6%) ì¸ìƒë˜ì—ˆìœ¼ë‚˜, ì´ëŠ” ì „ë°˜ì ì¸ ë¬¼ê°€ ìƒìŠ¹ë¥ ì— ë¹„í•´ ì—¬ì „íˆ ë¶€ì¡±í•œ ìˆ˜ì¤€ì´ë‹¤. íŠ¹íˆ ì¹œí™˜ê²½ ì‹ì¬ë£Œ ì˜ë¬´í™” ì •ì±…ìœ¼ë¡œ ì¸í•œ ì¶”ê°€ ë¹„ìš© ë¶€ë‹´ì€ ì´ë¯¸ ì œí•œëœ ê¸‰ì‹ ì˜ˆì‚°ì— ë”ìš± í° ì••ë°•ì„ ê°€í•˜ê³  ìˆë‹¤.

ğŸŒ **ì§€ì—­ë³„ ì¡°ë‹¬ ê²©ì°¨ ë¬¸ì œ**ëŠ” êµìœ¡ í˜•í‰ì„± ì¸¡ë©´ì—ì„œ ì‹¬ê°í•œ ìš°ë ¤ë¥¼ ë‚³ê³  ìˆë‹¤. ì„œìš¸ê³¼ ì „ë¶ ê°„ ê¸‰ì‹ë¹„ ì°¨ì´ê°€ 708ì›(4,098ì› vs 3,390ì›)ì— ë‹¬í•˜ëŠ” í˜„ì‹¤ì€ ë‹¨ìˆœí•œ ì§€ì—­ ì°¨ì´ë¥¼ ë„˜ì–´ êµ¬ì¡°ì  ë¶ˆí‰ë“±ì„ ì‹œì‚¬í•œë‹¤. êµìœ¡ì¬ì •êµë¶€ê¸ˆ ì¶•ì†Œë¡œ ì¸í•œ ì§€ì—­ë³„ ì¬ì • ë¶ˆê· í˜•ì´ ì‹¬í™”ë˜ê³  ìˆìœ¼ë©°, ë†ì–´ì´Œê³¼ ë„ì‹œ ê°„ ì‹ì¬ë£Œ ì¡°ë‹¬ í™˜ê²½ì˜ ê·¼ë³¸ì  ì°¨ì´ê°€ ì´ëŸ¬í•œ ê²©ì°¨ë¥¼ ë”ìš± ë²Œì–´ì§€ê²Œ í•˜ê³  ìˆë‹¤.

ğŸ’¡ **ë³¸ ë¶„ì„ì˜ ê¶ê·¹ì  ëª©ì **ì€ ì´ëŸ¬í•œ ë³µí•©ì  ë¬¸ì œì— ëŒ€í•œ ë°ì´í„° ê¸°ë°˜ì˜ ì‹¤ì§ˆì  í•´ê²°ë°©ì•ˆì„ ì œì‹œí•˜ëŠ” ê²ƒì´ë‹¤. ì œí•œëœ ì˜ˆì‚° ë‚´ì—ì„œ ìµœëŒ€ íš¨ê³¼ë¥¼ ì°½ì¶œí•  ìˆ˜ ìˆëŠ” ì¡°ë‹¬ íš¨ìœ¨ì„± ê°œì„  ì „ëµì„ ë„ì¶œí•˜ê³ , ì§€ì—­ë³„ ê²©ì°¨ë¥¼ ì¤„ì´ë©´ì„œë„ ì§€ì† ê°€ëŠ¥í•œ í•™êµê¸‰ì‹ ìš´ì˜ ëª¨ë¸ì„ êµ¬ì¶•í•˜ì—¬ ëª¨ë“  í•™ìƒì´ ì–‘ì§ˆì˜ ê¸‰ì‹ ì„œë¹„ìŠ¤ë¥¼ ë°›ì„ ìˆ˜ ìˆëŠ” ê¸°ë°˜ì„ ë§ˆë ¨í•˜ê³ ì í•œë‹¤.

### 4ë‹¨ê³„ ë¶„ì„ ì ‘ê·¼ ë°©ë²•ë¡  {#sec-analysis-approach}

ë³¸ ë¶„ì„ì€ **ë¬¸ì œ-ë¶„ì„-í•´ê²°** êµ¬ì¡°ë¥¼ ë”°ë¼ 4ë‹¨ê³„ë¡œ ì§„í–‰ëœë‹¤:

ğŸ“Š **4ë‹¨ê³„ ë¶„ì„ í”„ë ˆì„ì›Œí¬**(@fig-analysis-strategy)ëŠ” ì²´ê³„ì ì´ê³  ì ì§„ì ì¸ ì ‘ê·¼ì„ í†µí•´ í•™êµê¸‰ì‹ ì¡°ë‹¬ ë¬¸ì œì˜ ê·¼ë³¸ ì›ì¸ì„ íŒŒì•…í•˜ê³  ì‹¤ì§ˆì  í•´ê²°ë°©ì•ˆì„ ë„ì¶œí•˜ë„ë¡ ì„¤ê³„ë˜ì—ˆë‹¤.

**ã€1ë‹¨ê³„ã€‘ ğŸª ì†Œë§¤ì‹œì¥ ë¶„ì„**ì—ì„œëŠ” ê¸‰ì‹ì‹œì¥ì„ ì´í•´í•˜ê¸° ìœ„í•œ ê¸°ì¤€ì ì„ ì„¤ì •í•œë‹¤. ì‹œì¥ ì „ì²´ì˜ ë§¥ë½ì„ íŒŒì•…í•˜ê³  ê°€ê²© ê¸°ì¤€ì ì„ ì„¤ì •í•˜ë©°, ìœ í†µì±„ë„ë³„ ë§¤ì¶œ ë¶„í¬ì™€ ê³„ì ˆì„± íŒ¨í„´ì„ ë¶„ì„í•˜ì—¬ ì‹œì¥ì˜ ê¸°ë³¸ êµ¬ì¡°ë¥¼ ì´í•´í•œë‹¤. ì´ëŠ” **ã€2ë‹¨ê³„ã€‘ ğŸš ê¸‰ì‹ì‹œì¥ ë¶„ì„**ì˜ í† ëŒ€ê°€ ë˜ë©°, ì—¬ê¸°ì„œëŠ” ì‹¤ì œ ê¸‰ì‹ ì¡°ë‹¬ í˜„í™©ì„ íŒŒì•…í•˜ê³  íš¨ìœ¨ì„±ì„ ì¸¡ì •í•œë‹¤. ìœ í†µì±„ë„ë³„ ë‹¨ê°€ ë¹„êµì™€ ì§€ì—­ë³„ íŠ¹ì„± ë¶„ì„ì„ í†µí•´ ê¸‰ì‹ì‹œì¥ë§Œì˜ ê³ ìœ í•œ íŠ¹ì„±ì„ ê·œëª…í•œë‹¤.

**ã€3ë‹¨ê³„ã€‘ ğŸ”„ í†µí•© ë¹„êµ ë¶„ì„**ì—ì„œëŠ” ì•ì„œ ë„ì¶œëœ ì†Œë§¤ì‹œì¥ê³¼ ê¸‰ì‹ì‹œì¥ì˜ ì¸ì‚¬ì´íŠ¸ë¥¼ ê²°í•©í•˜ì—¬ ë‘ ì‹œì¥ ê°„ì˜ ê²©ì°¨ì™€ ìƒê´€ê´€ê³„ë¥¼ ë¶„ì„í•œë‹¤. ì´ë¥¼ í†µí•´ ì†Œë§¤ì‹œì¥ê³¼ ê¸‰ì‹ì‹œì¥ì˜ êµ¬ì¡°ì  ê´€ê³„ë¥¼ ê·œëª…í•˜ê³ , ê¸‰ì‹ì‹œì¥ì´ ì†Œë§¤ì‹œì¥ê³¼ ì–´ë–»ê²Œ ë‹¤ë¥¸ ë™í•™ì„ ê°€ì§€ëŠ”ì§€ íŒŒì•…í•œë‹¤. ë§ˆì§€ë§‰ **ã€4ë‹¨ê³„ã€‘ ğŸ« ì„¸ë¶€ ë¶„ì„**ì—ì„œëŠ” í•™êµê¸‰ë³„ ì¡°ë‹¬ íŒ¨í„´ê³¼ ì§€ì—­ë³„ íŠ¹ì„±ì„ ë¯¸ì‹œì ìœ¼ë¡œ ë¶„ì„í•˜ì—¬ êµ¬ì²´ì ì´ê³  ì‹¤í–‰ ê°€ëŠ¥í•œ ìµœì í™” ì „ëµì„ ë„ì¶œí•œë‹¤.

ğŸ¯ **ìµœì¢… ëª©í‘œ**ëŠ” ì´ 4ë‹¨ê³„ ë¶„ì„ì„ í†µí•´ **ë¹„ìš© íš¨ìœ¨í™”**, **ì œë„ ê°œì„ **, **ì‹¤í–‰ ë°©ì•ˆ**ì´ë¼ëŠ” ì„¸ ê°€ì§€ ì¶•ìœ¼ë¡œ êµ¬ì„±ëœ ì¢…í•©ì  í•´ê²°ì±…ì„ ì œì‹œí•˜ëŠ” ê²ƒì´ë‹¤.

### ë°ì´í„° ì „ì²˜ë¦¬ ë° ì •í•©ì„± ê²€ì¦ {#sec-data-preprocessing}

```{r}
#| label: data-processing
#| warning: false
# ë°ì´í„° ì •í•©ì„± ê²€ì¦
cat("ğŸ” ë°ì´í„° ì •í•©ì„± ê²€ì¦\n")
cat("- ê²°ì¸¡ê°’ í˜„í™©:\n")
missing_summary <- meal_data %>%
  summarise(across(everything(), ~sum(is.na(.x)))) %>%
  pivot_longer(everything(), names_to = "ë³€ìˆ˜", values_to = "ê²°ì¸¡ê°’ìˆ˜") %>%
  filter(ê²°ì¸¡ê°’ìˆ˜ > 0) %>%
  arrange(desc(ê²°ì¸¡ê°’ìˆ˜))

if(nrow(missing_summary) > 0) {
  for(i in 1:min(5, nrow(missing_summary))) {
    cat("  ", missing_summary$ë³€ìˆ˜[i], ":", missing_summary$ê²°ì¸¡ê°’ìˆ˜[i], "ê°œ\n")
  }
} else {
  cat("  ê²°ì¸¡ê°’ ì—†ìŒ\n")
}

cat("- ìŒìˆ˜ê°’ ê²€ì‚¬:\n")
numeric_cols <- meal_data %>% select(where(is.numeric), -ë…„ë„, -ì›”, -ë¶„ê¸°) %>% names()
negative_check <- meal_data %>%
  summarise(across(all_of(numeric_cols), ~sum(.x < 0, na.rm = TRUE))) %>%
  pivot_longer(everything(), names_to = "ë³€ìˆ˜", values_to = "ìŒìˆ˜ê°œìˆ˜") %>%
  filter(ìŒìˆ˜ê°œìˆ˜ > 0)

if(nrow(negative_check) > 0) {
  cat("  ìŒìˆ˜ê°’ ë°œê²¬:", nrow(negative_check), "ê°œ ë³€ìˆ˜\n")
} else {
  cat("  ìŒìˆ˜ê°’ ì—†ìŒ\n")
}

# ë°ì´í„° ë¶„ë¦¬ ì „ëµ: 3ê°œ ì „ë¬¸í™”ëœ ë°ì´í„°í”„ë ˆì„ ìƒì„±

cat("ğŸ”„ ë°ì´í„° ë¶„ë¦¬ ì „ëµ ì‹¤í–‰\n\n")

# 1. ì†Œë§¤ì‹œì¥ ì „ìš© ë°ì´í„°í”„ë ˆì„ (retail_df)
cat("1ï¸âƒ£ ì†Œë§¤ì‹œì¥ ë°ì´í„°í”„ë ˆì„ ìƒì„±\n")
retail_df <- meal_data %>%
  select(
    # ê³µí†µ ì‹ë³„ ë³€ìˆ˜
    ì¹´í…Œê³ ë¦¬, ìœ í†µì±„ë„, ê´‘ì—­ì‹œë„, ë‚ ì§œ, ë…„ë„, ì›”, ë¶„ê¸°, ê³„ì ˆ,
    # ì†Œë§¤ì‹œì¥ ì „ìš© ë³€ìˆ˜
    ì†Œë§¤_ë§¤ì¶œì•¡_ì›
  ) %>%
  # ì†Œë§¤ì‹œì¥ íŠ¹í™” ì§‘ê³„
  group_by(ë‚ ì§œ, ë…„ë„, ì›”, ë¶„ê¸°, ê³„ì ˆ, ìœ í†µì±„ë„, ê´‘ì—­ì‹œë„) %>%
  summarise(
    ì†Œë§¤_ì´ë§¤ì¶œ = sum(ì†Œë§¤_ë§¤ì¶œì•¡_ì›, na.rm = TRUE),
    .groups = 'drop'
  ) %>%
  filter(ì†Œë§¤_ì´ë§¤ì¶œ > 0) %>%
  # ì†Œë§¤ì‹œì¥ ë¶„ì„ìš© ì¶”ê°€ ë³€ìˆ˜
  group_by(ìœ í†µì±„ë„) %>%
  mutate(
    ì†Œë§¤_ì±„ë„ë‚´_ìˆœìœ„ = rank(desc(ì†Œë§¤_ì´ë§¤ì¶œ)),
    ì†Œë§¤_ì±„ë„ë‚´_ë¹„ì¤‘ = ì†Œë§¤_ì´ë§¤ì¶œ / sum(ì†Œë§¤_ì´ë§¤ì¶œ) * 100
  ) %>%
  ungroup()

cat("  - ì†Œë§¤ì‹œì¥ ê´€ì¸¡ì¹˜:", nrow(retail_df), "ê±´\n")
cat("  - í‰ê·  ì†Œë§¤ë§¤ì¶œ:", comma(round(mean(retail_df$ì†Œë§¤_ì´ë§¤ì¶œ))), "ì›\n")

# 2. í•™êµê¸‰ì‹ ì „ìš© ë°ì´í„°í”„ë ˆì„ (school_df)
cat("\n2ï¸âƒ£ í•™êµê¸‰ì‹ ë°ì´í„°í”„ë ˆì„ ìƒì„±\n")
school_df <- meal_data %>%
  # ê²°ì¸¡ê°’ì„ 0ìœ¼ë¡œ ì²˜ë¦¬ (ê¸‰ì‹ ë°ì´í„°ì˜ íŠ¹ì„±ìƒ ì—†ëŠ” ê²ƒì€ 0ìœ¼ë¡œ ê°„ì£¼)
  mutate(across(starts_with("KG_"), ~replace_na(.x, 0)),
         across(starts_with("ì›_"), ~replace_na(.x, 0))) %>%
  # í•™êµê¸‰ë³„ ì´í•© ê³„ì‚°
  rowwise() %>%
  mutate(
    ì´_KG = sum(c_across(starts_with("KG_")), na.rm = TRUE),
    ì´_ì› = sum(c_across(starts_with("ì›_")), na.rm = TRUE),
    # ë‹¨ê°€ ê³„ì‚° (ì›/KG) - 0ìœ¼ë¡œ ë‚˜ëˆ„ê¸° ë°©ì§€
    ë‹¨ê°€_ì›_per_KG = ifelse(ì´_KG > 0, ì´_ì› / ì´_KG, NA)
  ) %>%
  ungroup() %>%
  # ê¸‰ì‹ ê´€ë ¨ ë³€ìˆ˜ë§Œ ì„ íƒ
  select(
    # ê³µí†µ ì‹ë³„ ë³€ìˆ˜
    ì¹´í…Œê³ ë¦¬, ìœ í†µì±„ë„, ê´‘ì—­ì‹œë„, ë‚ ì§œ, ë…„ë„, ì›”, ë¶„ê¸°, ê³„ì ˆ,
    # ê¸‰ì‹ ì „ìš© ë³€ìˆ˜
    starts_with("KG_"), starts_with("ì›_"), ì´_KG, ì´_ì›, ë‹¨ê°€_ì›_per_KG
  ) %>%
  # ìœ íš¨í•œ ê¸‰ì‹ ë°ì´í„°ë§Œ í•„í„°ë§
  filter(ì´_KG > 0, !is.na(ë‹¨ê°€_ì›_per_KG)) %>%
  # ê¸‰ì‹ì‹œì¥ ë¶„ì„ìš© ì¶”ê°€ ë³€ìˆ˜
  mutate(
    # ì´ìƒì¹˜ íƒì§€
    ë‹¨ê°€_Zì ìˆ˜ = scale(ë‹¨ê°€_ì›_per_KG)[,1],
    ì´ìƒì¹˜_ì—¬ë¶€ = abs(ë‹¨ê°€_Zì ìˆ˜) > 3
  ) %>%
  # ì±„ë„ë³„ íš¨ìœ¨ì„± ìˆœìœ„
  group_by(ìœ í†µì±„ë„) %>%
  mutate(
    ì±„ë„ë‚´_ë‹¨ê°€ìˆœìœ„ = rank(ë‹¨ê°€_ì›_per_KG),
    ì±„ë„ë‚´_íš¨ìœ¨ì„± = rank(ë‹¨ê°€_ì›_per_KG) / n() * 100
  ) %>%
  ungroup()

cat("  - ê¸‰ì‹ì‹œì¥ ê´€ì¸¡ì¹˜:", nrow(school_df), "ê±´\n")
cat("  - í‰ê·  ê¸‰ì‹ ë‹¨ê°€:", comma(round(mean(school_df$ë‹¨ê°€_ì›_per_KG))), "ì›/KG\n")
cat("  - ì´ìƒì¹˜ ê°œìˆ˜:", sum(school_df$ì´ìƒì¹˜_ì—¬ë¶€, na.rm = TRUE), "ê±´\n")

# 3. í†µí•© ë¹„êµ ë¶„ì„ìš© ë°ì´í„°í”„ë ˆì„ (integrated_df)
cat("\n3ï¸âƒ£ í†µí•© ë¶„ì„ ë°ì´í„°í”„ë ˆì„ ìƒì„±\n")

# ì†Œë§¤ì‹œì¥ ìš”ì•½
retail_summary <- retail_df %>%
  group_by(ë‚ ì§œ, ìœ í†µì±„ë„, ê´‘ì—­ì‹œë„) %>%
  summarise(
    ì†Œë§¤_ì´ë§¤ì¶œ = sum(ì†Œë§¤_ì´ë§¤ì¶œ, na.rm = TRUE),
    .groups = 'drop'
  )

# ê¸‰ì‹ì‹œì¥ ìš”ì•½
school_summary <- school_df %>%
  group_by(ë‚ ì§œ, ìœ í†µì±„ë„, ê´‘ì—­ì‹œë„) %>%
  summarise(
    ê¸‰ì‹_ì´ê¸ˆì•¡ = sum(ì´_ì›, na.rm = TRUE),
    ê¸‰ì‹_ì´ì¤‘ëŸ‰ = sum(ì´_KG, na.rm = TRUE),
    ê¸‰ì‹_í‰ê· ë‹¨ê°€ = mean(ë‹¨ê°€_ì›_per_KG, na.rm = TRUE),
    .groups = 'drop'
  )

# í†µí•© ë°ì´í„°í”„ë ˆì„ ìƒì„±
integrated_df <- retail_summary %>%
  inner_join(
    school_summary,
    by = c("ë‚ ì§œ", "ìœ í†µì±„ë„", "ê´‘ì—­ì‹œë„"),
    suffix = c("_ì†Œë§¤", "_ê¸‰ì‹")
  ) %>%
  mutate(
    # ì‹œì¥ ë¹„êµ ì§€í‘œ
    ì „ì²´_ì‹œì¥ê·œëª¨ = ì†Œë§¤_ì´ë§¤ì¶œ + ê¸‰ì‹_ì´ê¸ˆì•¡,
    ê¸‰ì‹_ì‹œì¥ì ìœ ìœ¨ = ê¸‰ì‹_ì´ê¸ˆì•¡ / ì „ì²´_ì‹œì¥ê·œëª¨ * 100,
    # íš¨ìœ¨ì„± ì§€í‘œ (ë‚®ì„ìˆ˜ë¡ íš¨ìœ¨ì )
    ì‹œì¥_íš¨ìœ¨ì„±_ì§€ìˆ˜ = ê¸‰ì‹_í‰ê· ë‹¨ê°€ / (ì†Œë§¤_ì´ë§¤ì¶œ / 1000000), # ì„ì‹œ ì§€í‘œ
    # ì‹œê³„ì—´ ë³€ìˆ˜ ì¶”ê°€
    ë…„ë„ = year(ë‚ ì§œ),
    ì›” = month(ë‚ ì§œ),
    ë¶„ê¸° = quarter(ë‚ ì§œ),
    ê³„ì ˆ = case_when(
      month(ë‚ ì§œ) %in% c(12, 1, 2) ~ "ê²¨ìš¸",
      month(ë‚ ì§œ) %in% c(3, 4, 5) ~ "ë´„",
      month(ë‚ ì§œ) %in% c(6, 7, 8) ~ "ì—¬ë¦„",
      month(ë‚ ì§œ) %in% c(9, 10, 11) ~ "ê°€ì„"
    ),
    ê³„ì ˆ = factor(ê³„ì ˆ, levels = c("ë´„", "ì—¬ë¦„", "ê°€ì„", "ê²¨ìš¸"))
  )

cat("  - í†µí•© ë¶„ì„ ê´€ì¸¡ì¹˜:", nrow(integrated_df), "ê±´\n")
cat("  - í‰ê·  ê¸‰ì‹ ì‹œì¥ì ìœ ìœ¨:", round(mean(integrated_df$ê¸‰ì‹_ì‹œì¥ì ìœ ìœ¨, na.rm = TRUE), 1), "%\n")

# ì „ì²´ ìš”ì•½
cat("\nğŸ“Š ë°ì´í„° ë¶„ë¦¬ ì™„ë£Œ ìš”ì•½\n")
cat("- ì›ë³¸ ë°ì´í„°:", nrow(meal_data), "ê±´\n")
cat("- ì†Œë§¤ì‹œì¥ DF:", nrow(retail_df), "ê±´\n")
cat("- ê¸‰ì‹ì‹œì¥ DF:", nrow(school_df), "ê±´\n")
cat("- í†µí•© ë¶„ì„ DF:", nrow(integrated_df), "ê±´\n")
cat("- ë©”ëª¨ë¦¬ íš¨ìœ¨ì„±: ê° ì‹œì¥ë³„ ë…ë¦½ì  ë¶„ì„ ê°€ëŠ¥\n")
```

## ì‹œê³„ì—´ ë°ì´í„° ê°œìš” {#sec-time-series-overview}

### ì›”ë³„ ë°ì´í„° ë¶„í¬ í™•ì¸ {#sec-monthly-distribution}

```{r}
#| label: monthly-overview
#| warning: false
# ì›”ë³„ ë°ì´í„° ë¶„í¬ í™•ì¸ (ë¶„ë¦¬ëœ ë°ì´í„° í™œìš©)
# ì†Œë§¤ì‹œì¥ ì›”ë³„ ìš”ì•½
retail_monthly_overview <- retail_df %>%
  group_by(ë‚ ì§œ, ë…„ë„, ì›”, ê³„ì ˆ) %>%
  summarise(
    ì†Œë§¤_ì´ë§¤ì¶œ = sum(ì†Œë§¤_ì´ë§¤ì¶œ, na.rm = TRUE),
    ê´€ì¸¡ì¹˜ìˆ˜_ì†Œë§¤ = n(),
    .groups = 'drop'
  )

# ê¸‰ì‹ì‹œì¥ ì›”ë³„ ìš”ì•½
school_monthly_overview <- school_df %>%
  group_by(ë‚ ì§œ, ë…„ë„, ì›”, ê³„ì ˆ) %>%
  summarise(
    ê¸‰ì‹_ì´ê¸ˆì•¡ = sum(ì´_ì›, na.rm = TRUE),
    ê¸‰ì‹_ì´ì¤‘ëŸ‰ = sum(ì´_KG, na.rm = TRUE),
    í‰ê· _ë‹¨ê°€ = mean(ë‹¨ê°€_ì›_per_KG, na.rm = TRUE),
    ê´€ì¸¡ì¹˜ìˆ˜_ê¸‰ì‹ = n(),
    .groups = 'drop'
  )

# í†µí•© ì›”ë³„ ê°œìš”
monthly_overview <- retail_monthly_overview %>%
  full_join(school_monthly_overview, by = c("ë‚ ì§œ", "ë…„ë„", "ì›”", "ê³„ì ˆ")) %>%
  arrange(ë‚ ì§œ)

cat("ğŸ“… 2024ë…„ ì›”ë³„ ë°ì´í„° í˜„í™© (ë¶„ë¦¬ëœ ë°ì´í„°)\n\n")
for(i in 1:nrow(monthly_overview)) {
  cat(sprintf("%s: ì†Œë§¤ %sê±´/%sì›, ê¸‰ì‹ %sê±´/%sì› (%s)\n",
              format(monthly_overview$ë‚ ì§œ[i], "%Yë…„ %mì›”"),
              ifelse(is.na(monthly_overview$ê´€ì¸¡ì¹˜ìˆ˜_ì†Œë§¤[i]), 0, monthly_overview$ê´€ì¸¡ì¹˜ìˆ˜_ì†Œë§¤[i]),
              comma(ifelse(is.na(monthly_overview$ì†Œë§¤_ì´ë§¤ì¶œ[i]), 0, monthly_overview$ì†Œë§¤_ì´ë§¤ì¶œ[i])),
              ifelse(is.na(monthly_overview$ê´€ì¸¡ì¹˜ìˆ˜_ê¸‰ì‹[i]), 0, monthly_overview$ê´€ì¸¡ì¹˜ìˆ˜_ê¸‰ì‹[i]),
              comma(ifelse(is.na(monthly_overview$ê¸‰ì‹_ì´ê¸ˆì•¡[i]), 0, monthly_overview$ê¸‰ì‹_ì´ê¸ˆì•¡[i])),
              monthly_overview$ê³„ì ˆ[i]))
}

# ê³„ì ˆë³„ ìš”ì•½
cat("\nğŸ“Š ê³„ì ˆë³„ ìš”ì•½\n")
seasonal_summary <- monthly_overview %>%
  group_by(ê³„ì ˆ) %>%
  summarise(
    ì›”ìˆ˜ = n(),
    í‰ê· _ì†Œë§¤ê´€ì¸¡ì¹˜ = round(mean(ê´€ì¸¡ì¹˜ìˆ˜_ì†Œë§¤, na.rm = TRUE)),
    í‰ê· _ê¸‰ì‹ê´€ì¸¡ì¹˜ = round(mean(ê´€ì¸¡ì¹˜ìˆ˜_ê¸‰ì‹, na.rm = TRUE)),
    ì´_ì†Œë§¤ë§¤ì¶œ = sum(ì†Œë§¤_ì´ë§¤ì¶œ, na.rm = TRUE),
    ì´_ê¸‰ì‹ê¸ˆì•¡ = sum(ê¸‰ì‹_ì´ê¸ˆì•¡, na.rm = TRUE),
    .groups = 'drop'
  )

for(i in 1:nrow(seasonal_summary)) {
  cat(sprintf("- %s (%sê°œì›”): ì†Œë§¤ %sê±´, ê¸‰ì‹ %sê±´, ì´ ë§¤ì¶œ %sì›\n",
              seasonal_summary$ê³„ì ˆ[i],
              seasonal_summary$ì›”ìˆ˜[i],
              comma(seasonal_summary$í‰ê· _ì†Œë§¤ê´€ì¸¡ì¹˜[i]),
              comma(seasonal_summary$í‰ê· _ê¸‰ì‹ê´€ì¸¡ì¹˜[i]),
              comma(seasonal_summary$ì´_ì†Œë§¤ë§¤ì¶œ[i] + seasonal_summary$ì´_ê¸‰ì‹ê¸ˆì•¡[i])))
}
```

# 1ë¶€. ì†Œë§¤ì‹œì¥ ë¶„ì„ {#sec-part1-retail-market}

## ì°¹ìŒ€ ì†Œë§¤ì‹œì¥ í˜„í™© ë¶„ì„ {#sec-retail-market-overview}

### ìœ í†µì±„ë„ë³„ ì†Œë§¤ë§¤ì¶œ ë¶„ì„ {#sec-retail-channel-analysis}

```{r}
#| label: retail-channel-analysis
#| warning: false
# ì†Œë§¤ì‹œì¥ ì±„ë„ë³„ ë¶„ì„ (retail_df ì‚¬ìš©)
retail_analysis <- retail_df %>%
  group_by(ìœ í†µì±„ë„) %>%
  summarise(
    ì´_ì†Œë§¤ë§¤ì¶œì•¡ = sum(ì†Œë§¤_ì´ë§¤ì¶œ, na.rm = TRUE),
    í‰ê· _ì†Œë§¤ë§¤ì¶œì•¡ = mean(ì†Œë§¤_ì´ë§¤ì¶œ, na.rm = TRUE),
    ë°ì´í„°ìˆ˜ = n(),
    .groups = 'drop'
  ) %>%
  mutate(
    ì‹œì¥ì ìœ ìœ¨ = percent(ì´_ì†Œë§¤ë§¤ì¶œì•¡ / sum(ì´_ì†Œë§¤ë§¤ì¶œì•¡))
  ) %>%
  arrange(desc(ì´_ì†Œë§¤ë§¤ì¶œì•¡))

cat("ğŸª ì†Œë§¤ì‹œì¥ ìœ í†µì±„ë„ë³„ í˜„í™©\n\n")
for(i in 1:nrow(retail_analysis)) {
  cat("ğŸ“Œ", retail_analysis$ìœ í†µì±„ë„[i], "\n")
  cat("  - ì´ ë§¤ì¶œ:", comma(retail_analysis$ì´_ì†Œë§¤ë§¤ì¶œì•¡[i]), "ì›\n")
  cat("  - ì‹œì¥ì ìœ ìœ¨:", retail_analysis$ì‹œì¥ì ìœ ìœ¨[i], "\n")
  cat("  - í‰ê·  ë§¤ì¶œ:", comma(retail_analysis$í‰ê· _ì†Œë§¤ë§¤ì¶œì•¡[i]), "ì›\n\n")
}
```

```{r}
#| label: retail-channel-table
#| tbl-cap: "ìœ í†µì±„ë„ë³„ ì†Œë§¤ë§¤ì¶œ í˜„í™©"
retail_analysis %>%
  mutate(
    ì´_ì†Œë§¤ë§¤ì¶œì•¡ = comma(ì´_ì†Œë§¤ë§¤ì¶œì•¡),
    í‰ê· _ì†Œë§¤ë§¤ì¶œì•¡ = comma(í‰ê· _ì†Œë§¤ë§¤ì¶œì•¡)
  ) %>%
  gt() %>%
  cols_width(
    ìœ í†µì±„ë„ ~ pct(25),
    ì´_ì†Œë§¤ë§¤ì¶œì•¡ ~ pct(25),
    í‰ê· _ì†Œë§¤ë§¤ì¶œì•¡ ~ pct(25),
    ì‹œì¥ì ìœ ìœ¨ ~ pct(15),
    ë°ì´í„°ìˆ˜ ~ pct(10)
  ) %>%
  tab_options(
    table.width = pct(100)
  ) %>%
  opt_table_font(
    font = "Apple Gothic"
  ) %>%
  tab_header(title = "ìœ í†µì±„ë„ë³„ ì†Œë§¤ë§¤ì¶œ ë¶„ì„")
```

### ì§€ì—­ë³„ ì†Œë§¤ì‹œì¥ ë¶„ì„ {#sec-retail-regional-analysis}

```{r}
#| label: retail-regional-analysis
#| warning: false
# ì§€ì—­ë³„ ì†Œë§¤ì‹œì¥ ë¶„ì„ (retail_df ì‚¬ìš©)
regional_retail <- retail_df %>%
  group_by(ê´‘ì—­ì‹œë„) %>%
  summarise(
    ì´_ì†Œë§¤ë§¤ì¶œì•¡ = sum(ì†Œë§¤_ì´ë§¤ì¶œ, na.rm = TRUE),
    í‰ê· _ì†Œë§¤ë§¤ì¶œì•¡ = mean(ì†Œë§¤_ì´ë§¤ì¶œ, na.rm = TRUE),
    ì£¼ìš”_ì±„ë„ = ìœ í†µì±„ë„[which.max(ì†Œë§¤_ì´ë§¤ì¶œ)],
    .groups = 'drop'
  ) %>%
  arrange(desc(ì´_ì†Œë§¤ë§¤ì¶œì•¡))

# ìƒìœ„ 10ê°œ ì§€ì—­
head(regional_retail, 10) %>%
  mutate(
    ì´_ì†Œë§¤ë§¤ì¶œì•¡ = comma(ì´_ì†Œë§¤ë§¤ì¶œì•¡),
    í‰ê· _ì†Œë§¤ë§¤ì¶œì•¡ = comma(í‰ê· _ì†Œë§¤ë§¤ì¶œì•¡)
  ) %>%
  gt() %>%
  cols_width(
    ê´‘ì—­ì‹œë„ ~ pct(25),
    ì´_ì†Œë§¤ë§¤ì¶œì•¡ ~ pct(30),
    í‰ê· _ì†Œë§¤ë§¤ì¶œì•¡ ~ pct(30),
    ì£¼ìš”_ì±„ë„ ~ pct(15)
  ) %>%
  tab_options(
    table.width = pct(100)
  ) %>%
  opt_table_font(
    font = "Apple Gothic"
  ) %>%
  tab_header(title = "ì§€ì—­ë³„ ì†Œë§¤ì‹œì¥ í˜„í™© (ìƒìœ„ 10ê°œ ì§€ì—­)")
```

### ì†Œë§¤ì‹œì¥ ì‹œê°í™” {#sec-retail-visualization}

```{r}
#| label: retail-market-viz
#| fig-cap: "ìœ í†µì±„ë„ë³„ ì†Œë§¤ë§¤ì¶œì•¡ ë¶„í¬"
#| fig-width: 12
#| fig-height: 8
# ì†Œë§¤ì‹œì¥ ì±„ë„ë³„ ì‹œê°í™”
ggplot(retail_analysis, aes(x = reorder(ìœ í†µì±„ë„, ì´_ì†Œë§¤ë§¤ì¶œì•¡), y = ì´_ì†Œë§¤ë§¤ì¶œì•¡)) +
  geom_col(fill = "#2E86AB", alpha = 0.8) +
  geom_text(aes(label = ì‹œì¥ì ìœ ìœ¨), hjust = -0.1, family = "Apple Gothic", size = 4) +
  scale_y_continuous(labels = comma_format(scale = 1e-6, suffix = "M")) +
  coord_flip() +
  labs(
    title = "ì†Œë§¤ì‹œì¥ ìœ í†µì±„ë„ë³„ ë§¤ì¶œ ë¶„í¬",
    subtitle = "2024ë…„ 1ì›” ì°¹ìŒ€ ì†Œë§¤ë§¤ì¶œì•¡ (ë‹¨ìœ„: ë°±ë§Œì›)",
    x = "ìœ í†µì±„ë„",
    y = "ì´ ë§¤ì¶œì•¡ (ë°±ë§Œì›)",
    caption = "ë°ì´í„°: ë†ì‹í’ˆ ì˜¨Â·ì˜¤í”„ë¼ì¸ ìœ í†µ í’ˆëª© íŒë§¤ ë°ì´í„°"
  ) +
  theme_minimal() +
  theme(
    text = element_text(family = "Apple Gothic"),
    plot.title = element_text(family = "Apple Gothic", size = 14, face = "bold"),
    plot.subtitle = element_text(family = "Apple Gothic", size = 12),
    axis.text = element_text(family = "Apple Gothic"),
    axis.title = element_text(family = "Apple Gothic")
  )
```

### ì†Œë§¤ì‹œì¥ ì‹œê³„ì—´ ë¶„ì„ {#sec-retail-time-series}

```{r}
#| label: retail-time-series
#| fig-cap: "2024ë…„ ì›”ë³„ ì†Œë§¤ë§¤ì¶œì•¡ ì¶”ì´"
#| fig-width: 12
#| fig-height: 8
# ì›”ë³„ ì†Œë§¤ì‹œì¥ ì¶”ì´ ë¶„ì„ (retail_df ì‚¬ìš©)
retail_monthly <- retail_df %>%
  group_by(ë‚ ì§œ, ì›”, ê³„ì ˆ) %>%
  summarise(
    ì†Œë§¤_ì´ë§¤ì¶œ = sum(ì†Œë§¤_ì´ë§¤ì¶œ, na.rm = TRUE),
    .groups = 'drop'
  )

# ì†Œë§¤ë§¤ì¶œ ì›”ë³„ ì¶”ì´
ggplot(retail_monthly, aes(x = ë‚ ì§œ, y = ì†Œë§¤_ì´ë§¤ì¶œ)) +
  geom_line(color = "#2E86AB", size = 1.2) +
  geom_point(color = "#2E86AB", size = 3) +
  geom_text(aes(label = paste0(ì›”, "ì›”")), vjust = -0.8, family = "Apple Gothic", size = 3) +
  scale_x_date(date_labels = "%mì›”", date_breaks = "1 month") +
  scale_y_continuous(labels = comma_format(scale = 1e-9, suffix = "B")) +
  labs(
    title = "2024ë…„ ì°¹ìŒ€ ì†Œë§¤ì‹œì¥ ì›”ë³„ ë§¤ì¶œ ì¶”ì´",
    subtitle = "ì›”ë³„ ì†Œë§¤ë§¤ì¶œì•¡ ë³€í™” (ë‹¨ìœ„: ì‹­ì–µì›)",
    x = "ì›”",
    y = "ì†Œë§¤ë§¤ì¶œì•¡ (ì‹­ì–µì›)",
    caption = "ë°ì´í„°: ë†ì‹í’ˆ ì˜¨Â·ì˜¤í”„ë¼ì¸ ìœ í†µ í’ˆëª© íŒë§¤ ë°ì´í„°"
  ) +
  theme_minimal() +
  theme(
    text = element_text(family = "Apple Gothic"),
    plot.title = element_text(family = "Apple Gothic", size = 14, face = "bold"),
    plot.subtitle = element_text(family = "Apple Gothic", size = 12),
    axis.text = element_text(family = "Apple Gothic"),
    axis.title = element_text(family = "Apple Gothic"),
    axis.text.x = element_text(angle = 45, hjust = 1)
  )
```

```{r}
#| label: retail-channel-monthly
#| fig-cap: "ìœ í†µì±„ë„ë³„ ì›”ë³„ ì†Œë§¤ë§¤ì¶œ íŒ¨í„´"
#| fig-width: 14
#| fig-height: 8
# ì±„ë„ë³„ ì›”ë³„ ì¶”ì´ (retail_df ì‚¬ìš©)
retail_channel_monthly <- retail_df %>%
  group_by(ë‚ ì§œ, ì›”, ìœ í†µì±„ë„, ê³„ì ˆ) %>%
  summarise(
    ì†Œë§¤_ì´ë§¤ì¶œ = sum(ì†Œë§¤_ì´ë§¤ì¶œ, na.rm = TRUE),
    .groups = 'drop'
  )

ggplot(retail_channel_monthly, aes(x = ì›”, y = ì†Œë§¤_ì´ë§¤ì¶œ, color = ìœ í†µì±„ë„)) +
  geom_line(size = 1.2) +
  geom_point(size = 2.5) +
  scale_x_continuous(breaks = 1:12, labels = paste0(1:12, "ì›”")) +
  scale_y_continuous(labels = comma_format(scale = 1e-6, suffix = "M")) +
  labs(
    title = "ìœ í†µì±„ë„ë³„ ì›”ë³„ ì†Œë§¤ë§¤ì¶œ íŒ¨í„´",
    subtitle = "2024ë…„ ì±„ë„ë³„ ê³„ì ˆì„± ë¶„ì„ (ë‹¨ìœ„: ë°±ë§Œì›)",
    x = "ì›”",
    y = "ì†Œë§¤ë§¤ì¶œì•¡ (ë°±ë§Œì›)",
    color = "ìœ í†µì±„ë„"
  ) +
  theme_minimal() +
  theme(
    text = element_text(family = "Apple Gothic"),
    plot.title = element_text(family = "Apple Gothic", size = 14, face = "bold"),
    plot.subtitle = element_text(family = "Apple Gothic", size = 12),
    axis.text = element_text(family = "Apple Gothic"),
    axis.title = element_text(family = "Apple Gothic"),
    legend.text = element_text(family = "Apple Gothic"),
    legend.title = element_text(family = "Apple Gothic"),
    legend.position = "bottom"
  )
```

```{r}
#| label: retail-heatmap
#| fig-cap: "ì›”ë³„Ã—ì±„ë„ë³„ ì†Œë§¤ë§¤ì¶œ íˆíŠ¸ë§µ"
#| fig-width: 12
#| fig-height: 8
# íˆíŠ¸ë§µìš© ë°ì´í„° ì¤€ë¹„
retail_heatmap_data <- retail_channel_monthly %>%
  mutate(
    ë§¤ì¶œ_ì •ê·œí™” = scale(ì†Œë§¤_ì´ë§¤ì¶œ)[,1]  # í‘œì¤€í™”
  )

ggplot(retail_heatmap_data, aes(x = factor(ì›”), y = ìœ í†µì±„ë„, fill = ë§¤ì¶œ_ì •ê·œí™”)) +
  geom_tile(color = "white", size = 0.5) +
  geom_text(aes(label = paste0(comma(round(ì†Œë§¤_ì´ë§¤ì¶œ/1e6, 1)), "M")),
            family = "Apple Gothic", size = 3, color = "white") +
  scale_fill_gradient2(
    low = "#2E86AB", mid = "white", high = "#A23B72",
    midpoint = 0, name = "ë§¤ì¶œ ê°•ë„\n(í‘œì¤€í™”)"
  ) +
  scale_x_discrete(labels = paste0(1:12, "ì›”")) +
  labs(
    title = "ì†Œë§¤ì‹œì¥ ì›”ë³„Ã—ì±„ë„ë³„ ë§¤ì¶œ íˆíŠ¸ë§µ",
    subtitle = "ìƒ‰ìƒ ê°•ë„: ë†’ì„ìˆ˜ë¡ í‰ê·  ëŒ€ë¹„ ë†’ì€ ë§¤ì¶œ",
    x = "ì›”",
    y = "ìœ í†µì±„ë„"
  ) +
  theme_minimal() +
  theme(
    text = element_text(family = "Apple Gothic"),
    plot.title = element_text(family = "Apple Gothic", size = 14, face = "bold"),
    plot.subtitle = element_text(family = "Apple Gothic", size = 12),
    axis.text = element_text(family = "Apple Gothic"),
    axis.title = element_text(family = "Apple Gothic"),
    legend.text = element_text(family = "Apple Gothic"),
    legend.title = element_text(family = "Apple Gothic"),
    panel.grid = element_blank()
  )
```

```{r}
#| label: retail-boxplot-seasonality
#| fig-cap: "ì†Œë§¤ë§¤ì¶œì˜ ì›”ë³„ ë¶„í¬ì™€ ê³„ì ˆì„±"
#| fig-width: 14
#| fig-height: 8
# ì›”ë³„ ë°•ìŠ¤í”Œë¡¯ (retail_df ì‚¬ìš©)
retail_boxplot_data <- retail_df

ggplot(retail_boxplot_data, aes(x = factor(ì›”), y = ì†Œë§¤_ì´ë§¤ì¶œ, fill = ê³„ì ˆ)) +
  geom_boxplot(alpha = 0.7, outlier.alpha = 0.5) +
  stat_summary(fun = mean, geom = "point", shape = 23, size = 3, fill = "red") +
  scale_y_continuous(labels = comma_format(scale = 1e-6, suffix = "M")) +
  scale_fill_manual(values = c("ë´„" = "#4CAF50", "ì—¬ë¦„" = "#FF9800", "ê°€ì„" = "#795548", "ê²¨ìš¸" = "#2196F3")) +
  labs(
    title = "ì†Œë§¤ë§¤ì¶œì˜ ì›”ë³„ ë¶„í¬ì™€ ê³„ì ˆì„± ë¶„ì„",
    subtitle = "ë°•ìŠ¤í”Œë¡¯: ë¶„í¬, ë¹¨ê°„ ë‹¤ì´ì•„ëª¬ë“œ: í‰ê· ê°’",
    x = "ì›”",
    y = "ì†Œë§¤ë§¤ì¶œì•¡ (ë°±ë§Œì›)",
    fill = "ê³„ì ˆ"
  ) +
  theme_minimal() +
  theme(
    text = element_text(family = "Apple Gothic"),
    plot.title = element_text(family = "Apple Gothic", size = 14, face = "bold"),
    plot.subtitle = element_text(family = "Apple Gothic", size = 12),
    axis.text = element_text(family = "Apple Gothic"),
    axis.title = element_text(family = "Apple Gothic"),
    legend.text = element_text(family = "Apple Gothic"),
    legend.title = element_text(family = "Apple Gothic"),
    legend.position = "bottom"
  )
```

# 2ë¶€. í•™êµê¸‰ì‹ ì „ì²´ ì‹œì¥ ë¶„ì„ {#sec-part2-school-total}

## í•™êµê¸‰ì‹ ì‹œì¥ í˜„í™© ë¶„ì„ {#sec-school-market-overview}

### ìœ í†µì±„ë„ë³„ ê¸‰ì‹ ì¡°ë‹¬ ë¶„ì„ {#sec-school-channel-analysis}

```{r}
#| label: school-channel-analysis
#| warning: false
# í•™êµê¸‰ì‹ ì±„ë„ë³„ ë¶„ì„ (school_df ì‚¬ìš©)
school_analysis <- school_df %>%
  group_by(ìœ í†µì±„ë„) %>%
  summarise(
    ì´_ê¸‰ì‹ê¸ˆì•¡ = sum(ì´_ì›, na.rm = TRUE),
    ì´_ê¸‰ì‹ì¤‘ëŸ‰ = sum(ì´_KG, na.rm = TRUE),
    í‰ê· _ë‹¨ê°€ = mean(ë‹¨ê°€_ì›_per_KG, na.rm = TRUE),
    ì¤‘ê°„ê°’_ë‹¨ê°€ = median(ë‹¨ê°€_ì›_per_KG, na.rm = TRUE),
    ë°ì´í„°ìˆ˜ = n(),
    .groups = 'drop'
  ) %>%
  mutate(
    ê¸‰ì‹_ì‹œì¥ì ìœ ìœ¨ = percent(ì´_ê¸‰ì‹ê¸ˆì•¡ / sum(ì´_ê¸‰ì‹ê¸ˆì•¡))
  ) %>%
  arrange(í‰ê· _ë‹¨ê°€)

cat("ğŸš í•™êµê¸‰ì‹ ìœ í†µì±„ë„ë³„ í˜„í™©\n\n")
for(i in 1:nrow(school_analysis)) {
  cat("ğŸ“Œ", school_analysis$ìœ í†µì±„ë„[i], "\n")
  cat("  - ì´ ì¡°ë‹¬ê¸ˆì•¡:", comma(school_analysis$ì´_ê¸‰ì‹ê¸ˆì•¡[i]), "ì›\n")
  cat("  - ì´ ì¡°ë‹¬ì¤‘ëŸ‰:", comma(school_analysis$ì´_ê¸‰ì‹ì¤‘ëŸ‰[i]), "KG\n")
  cat("  - í‰ê·  ë‹¨ê°€:", comma(school_analysis$í‰ê· _ë‹¨ê°€[i]), "ì›/KG\n")
  cat("  - ê¸‰ì‹ ì‹œì¥ì ìœ ìœ¨:", school_analysis$ê¸‰ì‹_ì‹œì¥ì ìœ ìœ¨[i], "\n\n")
}
```

```{r}
#| label: school-channel-table
#| tbl-cap: "ìœ í†µì±„ë„ë³„ í•™êµê¸‰ì‹ ì¡°ë‹¬ í˜„í™©"
school_analysis %>%
  mutate(
    ì´_ê¸‰ì‹ê¸ˆì•¡ = comma(ì´_ê¸‰ì‹ê¸ˆì•¡),
    ì´_ê¸‰ì‹ì¤‘ëŸ‰ = comma(ì´_ê¸‰ì‹ì¤‘ëŸ‰),
    í‰ê· _ë‹¨ê°€ = comma(í‰ê· _ë‹¨ê°€),
    ì¤‘ê°„ê°’_ë‹¨ê°€ = comma(ì¤‘ê°„ê°’_ë‹¨ê°€)
  ) %>%
  gt() %>%
  cols_width(
    ìœ í†µì±„ë„ ~ pct(20),
    ì´_ê¸‰ì‹ê¸ˆì•¡ ~ pct(20),
    ì´_ê¸‰ì‹ì¤‘ëŸ‰ ~ pct(15),
    í‰ê· _ë‹¨ê°€ ~ pct(15),
    ì¤‘ê°„ê°’_ë‹¨ê°€ ~ pct(15),
    ê¸‰ì‹_ì‹œì¥ì ìœ ìœ¨ ~ pct(15)
  ) %>%
  tab_options(
    table.width = pct(100)
  ) %>%
  opt_table_font(
    font = "Apple Gothic"
  ) %>%
  tab_header(title = "ìœ í†µì±„ë„ë³„ í•™êµê¸‰ì‹ ì¡°ë‹¬ ë¶„ì„")
```

### ì§€ì—­ë³„ ê¸‰ì‹ ì¡°ë‹¬ ë¶„ì„ {#sec-school-regional-analysis}

```{r}
#| label: school-regional-analysis
#| warning: false
# ì§€ì—­ë³„ ê¸‰ì‹ ì¡°ë‹¬ ë¶„ì„ (school_df ì‚¬ìš©)
regional_school <- school_df %>%
  group_by(ê´‘ì—­ì‹œë„) %>%
  summarise(
    ì´_ê¸‰ì‹ê¸ˆì•¡ = sum(ì´_ì›, na.rm = TRUE),
    ì´_ê¸‰ì‹ì¤‘ëŸ‰ = sum(ì´_KG, na.rm = TRUE),
    í‰ê· _ë‹¨ê°€ = mean(ë‹¨ê°€_ì›_per_KG, na.rm = TRUE),
    ì£¼ìš”_ì±„ë„ = ìœ í†µì±„ë„[which.min(ë‹¨ê°€_ì›_per_KG)],
    .groups = 'drop'
  ) %>%
  arrange(í‰ê· _ë‹¨ê°€)

# ìƒìœ„/í•˜ìœ„ ê° 5ê°œ ì§€ì—­
bind_rows(
  head(regional_school, 5) %>% mutate(êµ¬ë¶„ = "íš¨ìœ¨ì "),
  tail(regional_school, 5) %>% mutate(êµ¬ë¶„ = "ë¹„íš¨ìœ¨ì ")
) %>%
  mutate(
    ì´_ê¸‰ì‹ê¸ˆì•¡ = comma(ì´_ê¸‰ì‹ê¸ˆì•¡),
    ì´_ê¸‰ì‹ì¤‘ëŸ‰ = comma(ì´_ê¸‰ì‹ì¤‘ëŸ‰),
    í‰ê· _ë‹¨ê°€ = comma(í‰ê· _ë‹¨ê°€)
  ) %>%
  gt() %>%
  cols_width(
    êµ¬ë¶„ ~ pct(15),
    ê´‘ì—­ì‹œë„ ~ pct(20),
    ì´_ê¸‰ì‹ê¸ˆì•¡ ~ pct(25),
    ì´_ê¸‰ì‹ì¤‘ëŸ‰ ~ pct(20),
    í‰ê· _ë‹¨ê°€ ~ pct(20)
  ) %>%
  tab_options(
    table.width = pct(100)
  ) %>%
  opt_table_font(
    font = "Apple Gothic"
  ) %>%
  tab_header(title = "ì§€ì—­ë³„ ê¸‰ì‹ ì¡°ë‹¬ íš¨ìœ¨ì„± ë¶„ì„ (ìƒìœ„/í•˜ìœ„ 5ê°œ ì§€ì—­)")
```

### ê¸‰ì‹ ì¡°ë‹¬ ì‹œê°í™” {#sec-school-visualization}

```{r}
#| label: school-efficiency-viz
#| fig-cap: "ìœ í†µì±„ë„ë³„ ê¸‰ì‹ ì¡°ë‹¬ ë‹¨ê°€ ë¹„êµ"
#| fig-width: 12
#| fig-height: 8
# ê¸‰ì‹ ì¡°ë‹¬ íš¨ìœ¨ì„± ì‹œê°í™”
ggplot(school_analysis, aes(x = reorder(ìœ í†µì±„ë„, í‰ê· _ë‹¨ê°€), y = í‰ê· _ë‹¨ê°€)) +
  geom_col(fill = "#A23B72", alpha = 0.8) +
  geom_text(aes(label = comma(í‰ê· _ë‹¨ê°€)), hjust = -0.1, family = "Apple Gothic", size = 4) +
  scale_y_continuous(labels = comma_format()) +
  coord_flip() +
  labs(
    title = "ìœ í†µì±„ë„ë³„ ê¸‰ì‹ ì¡°ë‹¬ ë‹¨ê°€ ë¹„êµ",
    subtitle = "2024ë…„ 1ì›” ì°¹ìŒ€ í‰ê·  ë‹¨ê°€ (ì›/KG)",
    x = "ìœ í†µì±„ë„",
    y = "í‰ê·  ë‹¨ê°€ (ì›/KG)",
    caption = "ë‚®ì„ìˆ˜ë¡ íš¨ìœ¨ì ì¸ ì¡°ë‹¬"
  ) +
  theme_minimal() +
  theme(
    text = element_text(family = "Apple Gothic"),
    plot.title = element_text(family = "Apple Gothic", size = 14, face = "bold"),
    plot.subtitle = element_text(family = "Apple Gothic", size = 12),
    axis.text = element_text(family = "Apple Gothic"),
    axis.title = element_text(family = "Apple Gothic")
  )
```

### ê¸‰ì‹ ì¡°ë‹¬ ì‹œê³„ì—´ ë¶„ì„ {#sec-school-time-series}

```{r}
#| label: school-time-series
#| fig-cap: "2024ë…„ ì›”ë³„ ê¸‰ì‹ ì¡°ë‹¬ ì¶”ì´"
#| fig-width: 12
#| fig-height: 8
# ì›”ë³„ ê¸‰ì‹ ì¡°ë‹¬ ì¶”ì´ ë¶„ì„ (school_df ì‚¬ìš©)
school_monthly <- school_df %>%
  group_by(ë‚ ì§œ, ì›”, ê³„ì ˆ) %>%
  summarise(
    ê¸‰ì‹_ì´ê¸ˆì•¡ = sum(ì´_ì›, na.rm = TRUE),
    ê¸‰ì‹_ì´ì¤‘ëŸ‰ = sum(ì´_KG, na.rm = TRUE),
    í‰ê· _ë‹¨ê°€ = mean(ë‹¨ê°€_ì›_per_KG, na.rm = TRUE),
    .groups = 'drop'
  )

# ê¸‰ì‹ ì¡°ë‹¬ëŸ‰ê³¼ ë‹¨ê°€ ì´ì¤‘ì¶• ê·¸ë˜í”„
p1 <- ggplot(school_monthly, aes(x = ë‚ ì§œ)) +
  geom_col(aes(y = ê¸‰ì‹_ì´ê¸ˆì•¡ / 1e6), fill = "#A23B72", alpha = 0.7) +
  geom_line(aes(y = í‰ê· _ë‹¨ê°€ / 1000), color = "#FF6B35", size = 1.5) +
  geom_point(aes(y = í‰ê· _ë‹¨ê°€ / 1000), color = "#FF6B35", size = 3) +
  scale_x_date(date_labels = "%mì›”", date_breaks = "1 month") +
  scale_y_continuous(
    name = "ê¸‰ì‹ ì¡°ë‹¬ê¸ˆì•¡ (ë°±ë§Œì›)",
    labels = comma_format(),
    sec.axis = sec_axis(~ . * 1000, name = "í‰ê·  ë‹¨ê°€ (ì›/KG)", labels = comma_format())
  ) +
  labs(
    title = "2024ë…„ ì›”ë³„ ê¸‰ì‹ ì¡°ë‹¬ í˜„í™©",
    subtitle = "ì¡°ë‹¬ê¸ˆì•¡(ë§‰ëŒ€)ê³¼ í‰ê·  ë‹¨ê°€(ì„ ) ì¶”ì´",
    x = "ì›”",
    caption = "ì¢Œì¶•: ì¡°ë‹¬ê¸ˆì•¡, ìš°ì¶•: í‰ê·  ë‹¨ê°€"
  ) +
  theme_minimal() +
  theme(
    text = element_text(family = "Apple Gothic"),
    plot.title = element_text(family = "Apple Gothic", size = 14, face = "bold"),
    plot.subtitle = element_text(family = "Apple Gothic", size = 12),
    axis.text = element_text(family = "Apple Gothic"),
    axis.title = element_text(family = "Apple Gothic"),
    axis.text.x = element_text(angle = 45, hjust = 1),
    axis.title.y.left = element_text(color = "#A23B72"),
    axis.title.y.right = element_text(color = "#FF6B35")
  )

p1
```

```{r}
#| label: school-channel-seasonality
#| fig-cap: "ìœ í†µì±„ë„ë³„ ê¸‰ì‹ ì¡°ë‹¬ ê³„ì ˆì„± ë¶„ì„"
#| fig-width: 14
#| fig-height: 8
# ì±„ë„ë³„ ê¸‰ì‹ ì¡°ë‹¬ ê³„ì ˆì„± (school_df ì‚¬ìš©)
school_channel_monthly <- school_df %>%
  group_by(ë‚ ì§œ, ì›”, ìœ í†µì±„ë„, ê³„ì ˆ) %>%
  summarise(
    ê¸‰ì‹_ì´ê¸ˆì•¡ = sum(ì´_ì›, na.rm = TRUE),
    í‰ê· _ë‹¨ê°€ = mean(ë‹¨ê°€_ì›_per_KG, na.rm = TRUE),
    .groups = 'drop'
  )

# ì±„ë„ë³„ ì›”ë³„ ê¸‰ì‹ ì¡°ë‹¬ ê¸ˆì•¡
ggplot(school_channel_monthly, aes(x = ì›”, y = ê¸‰ì‹_ì´ê¸ˆì•¡, fill = ìœ í†µì±„ë„)) +
  geom_area(alpha = 0.7, position = "stack") +
  scale_x_continuous(breaks = 1:12, labels = paste0(1:12, "ì›”")) +
  scale_y_continuous(labels = comma_format(scale = 1e-6, suffix = "M")) +
  labs(
    title = "ìœ í†µì±„ë„ë³„ ì›”ë³„ ê¸‰ì‹ ì¡°ë‹¬ ê¸ˆì•¡",
    subtitle = "2024ë…„ ì±„ë„ë³„ ê¸‰ì‹ ì‹œì¥ ê³„ì ˆì„± (ë‹¨ìœ„: ë°±ë§Œì›)",
    x = "ì›”",
    y = "ê¸‰ì‹ ì¡°ë‹¬ê¸ˆì•¡ (ë°±ë§Œì›)",
    fill = "ìœ í†µì±„ë„"
  ) +
  theme_minimal() +
  theme(
    text = element_text(family = "Apple Gothic"),
    plot.title = element_text(family = "Apple Gothic", size = 14, face = "bold"),
    plot.subtitle = element_text(family = "Apple Gothic", size = 12),
    axis.text = element_text(family = "Apple Gothic"),
    axis.title = element_text(family = "Apple Gothic"),
    legend.text = element_text(family = "Apple Gothic"),
    legend.title = element_text(family = "Apple Gothic"),
    legend.position = "bottom"
  )
```

```{r}
#| label: school-efficiency-heatmap
#| fig-cap: "ê¸‰ì‹ ì¡°ë‹¬ íš¨ìœ¨ì„± íˆíŠ¸ë§µ (ë‹¨ê°€ ê¸°ì¤€)"
#| fig-width: 12
#| fig-height: 8
# ê¸‰ì‹ íš¨ìœ¨ì„± íˆíŠ¸ë§µ (ë‹¨ê°€ ê¸°ì¤€)
school_heatmap_data <- school_channel_monthly %>%
  mutate(
    ë‹¨ê°€_ì •ê·œí™” = scale(í‰ê· _ë‹¨ê°€)[,1]  # í‘œì¤€í™” (ë‚®ì„ìˆ˜ë¡ íš¨ìœ¨ì )
  )

ggplot(school_heatmap_data, aes(x = factor(ì›”), y = ìœ í†µì±„ë„, fill = -ë‹¨ê°€_ì •ê·œí™”)) +
  geom_tile(color = "white", size = 0.5) +
  geom_text(aes(label = paste0(comma(round(í‰ê· _ë‹¨ê°€)), "ì›")),
            family = "Apple Gothic", size = 3, color = "white") +
  scale_fill_gradient2(
    low = "#A23B72", mid = "white", high = "#4CAF50",
    midpoint = 0, name = "íš¨ìœ¨ì„±\n(ë†’ì„ìˆ˜ë¡ íš¨ìœ¨ì )"
  ) +
  scale_x_discrete(labels = paste0(1:12, "ì›”")) +
  labs(
    title = "ê¸‰ì‹ ì¡°ë‹¬ íš¨ìœ¨ì„± ì›”ë³„Ã—ì±„ë„ë³„ íˆíŠ¸ë§µ",
    subtitle = "ì´ˆë¡ìƒ‰: íš¨ìœ¨ì (ë‚®ì€ ë‹¨ê°€), ë¹¨ê°„ìƒ‰: ë¹„íš¨ìœ¨ì (ë†’ì€ ë‹¨ê°€)",
    x = "ì›”",
    y = "ìœ í†µì±„ë„"
  ) +
  theme_minimal() +
  theme(
    text = element_text(family = "Apple Gothic"),
    plot.title = element_text(family = "Apple Gothic", size = 14, face = "bold"),
    plot.subtitle = element_text(family = "Apple Gothic", size = 12),
    axis.text = element_text(family = "Apple Gothic"),
    axis.title = element_text(family = "Apple Gothic"),
    legend.text = element_text(family = "Apple Gothic"),
    legend.title = element_text(family = "Apple Gothic"),
    panel.grid = element_blank()
  )
```

```{r}
#| label: school-violin-plot
#| fig-cap: "ìœ í†µì±„ë„ë³„ ê¸‰ì‹ ë‹¨ê°€ ë¶„í¬ (ë°”ì´ì˜¬ë¦° í”Œë¡¯)"
#| fig-width: 14
#| fig-height: 8
# ë°”ì´ì˜¬ë¦° í”Œë¡¯ìœ¼ë¡œ ì±„ë„ë³„ ë‹¨ê°€ ë¶„í¬
ggplot(school_df, aes(x = reorder(ìœ í†µì±„ë„, ë‹¨ê°€_ì›_per_KG, median), y = ë‹¨ê°€_ì›_per_KG, fill = ìœ í†µì±„ë„)) +
  geom_violin(alpha = 0.7, scale = "width") +
  geom_boxplot(width = 0.2, alpha = 0.8, outlier.alpha = 0.5) +
  stat_summary(fun = mean, geom = "point", shape = 23, size = 3, fill = "red") +
  scale_y_continuous(labels = comma_format()) +
  labs(
    title = "ìœ í†µì±„ë„ë³„ ê¸‰ì‹ ë‹¨ê°€ ë¶„í¬ ìƒì„¸ ë¶„ì„",
    subtitle = "ë°”ì´ì˜¬ë¦°: ë¶„í¬ ë°€ë„, ë°•ìŠ¤í”Œë¡¯: ì‚¬ë¶„ìœ„ìˆ˜, ë¹¨ê°„ ë‹¤ì´ì•„ëª¬ë“œ: í‰ê· ",
    x = "ìœ í†µì±„ë„ (íš¨ìœ¨ì„± ìˆœì„œ)",
    y = "ë‹¨ê°€ (ì›/KG)",
    fill = "ìœ í†µì±„ë„"
  ) +
  theme_minimal() +
  theme(
    text = element_text(family = "Apple Gothic"),
    plot.title = element_text(family = "Apple Gothic", size = 14, face = "bold"),
    plot.subtitle = element_text(family = "Apple Gothic", size = 12),
    axis.text = element_text(family = "Apple Gothic"),
    axis.title = element_text(family = "Apple Gothic"),
    legend.position = "none",
    axis.text.x = element_text(angle = 45, hjust = 1)
  )
```

```{r}
#| label: correlation-matrix
#| fig-cap: "ì‹œì¥ ë³€ìˆ˜ ê°„ ìƒê´€ê´€ê³„ ë§¤íŠ¸ë¦­ìŠ¤"
#| fig-width: 10
#| fig-height: 8
# ìƒê´€ê´€ê³„ ë§¤íŠ¸ë¦­ìŠ¤ (integrated_df í™œìš© ì˜ˆì •ìœ¼ë¡œ ì„ì‹œ school_df ì‚¬ìš©)
correlation_data <- school_df %>%
  select(ì´_ì›, ì´_KG, ë‹¨ê°€_ì›_per_KG) %>%
  rename(
    "ê¸‰ì‹ê¸ˆì•¡" = "ì´_ì›",
    "ê¸‰ì‹ì¤‘ëŸ‰" = "ì´_KG",
    "ê¸‰ì‹ë‹¨ê°€" = "ë‹¨ê°€_ì›_per_KG"
  )

# ìƒê´€ê³„ìˆ˜ ê³„ì‚°
cor_matrix <- cor(correlation_data, use = "complete.obs")

# ìƒê´€ê³„ìˆ˜ë¥¼ long formatìœ¼ë¡œ ë³€í™˜
cor_long <- cor_matrix %>%
  as.data.frame() %>%
  rownames_to_column("var1") %>%
  pivot_longer(-var1, names_to = "var2", values_to = "correlation")

# ìƒê´€ê´€ê³„ íˆíŠ¸ë§µ
ggplot(cor_long, aes(x = var1, y = var2, fill = correlation)) +
  geom_tile(color = "white", size = 0.5) +
  geom_text(aes(label = round(correlation, 2)),
            family = "Apple Gothic", size = 4, color = "white") +
  scale_fill_gradient2(
    low = "#2E86AB", mid = "white", high = "#A23B72",
    midpoint = 0, name = "ìƒê´€ê³„ìˆ˜",
    breaks = c(-1, -0.5, 0, 0.5, 1),
    labels = c("-1.0", "-0.5", "0.0", "0.5", "1.0")
  ) +
  labs(
    title = "ì‹œì¥ ë³€ìˆ˜ ê°„ ìƒê´€ê´€ê³„ ë¶„ì„",
    subtitle = "ì–‘ì˜ ìƒê´€ê´€ê³„(ë¹¨ê°•), ìŒì˜ ìƒê´€ê´€ê³„(íŒŒë‘)",
    x = "",
    y = ""
  ) +
  theme_minimal() +
  theme(
    text = element_text(family = "Apple Gothic"),
    plot.title = element_text(family = "Apple Gothic", size = 14, face = "bold"),
    plot.subtitle = element_text(family = "Apple Gothic", size = 12),
    axis.text = element_text(family = "Apple Gothic", angle = 45, hjust = 1),
    panel.grid = element_blank()
  )
```

# 3ë¶€. ì‹œì¥ í†µí•© ë¹„êµ ë¶„ì„ {#sec-part3-market-comparison}

## ì†Œë§¤ì‹œì¥ vs í•™êµê¸‰ì‹ ì‹œì¥ ë¹„êµ {#sec-market-comparison}

```{r}
#| label: market-size-calculation
#| warning: false
# ì‹œì¥ ê·œëª¨ ê³„ì‚° (integrated_df ì‚¬ìš©)
market_analysis <- integrated_df %>%
  group_by(ìœ í†µì±„ë„, ê´‘ì—­ì‹œë„) %>%
  summarise(
    ì†Œë§¤_ì´ì•¡ = sum(ì†Œë§¤_ì´ë§¤ì¶œ, na.rm = TRUE),
    ê¸‰ì‹_ì´ì•¡ = sum(ê¸‰ì‹_ì´ê¸ˆì•¡, na.rm = TRUE),
    ê¸‰ì‹_ì´ì¤‘ëŸ‰ = sum(ê¸‰ì‹_ì´ì¤‘ëŸ‰, na.rm = TRUE),
    .groups = 'drop'
  )

# ì „ì²´ ì‹œì¥ ìš”ì•½
total_market <- market_analysis %>%
  summarise(
    ì´_ì†Œë§¤_ì‹œì¥ = sum(ì†Œë§¤_ì´ì•¡, na.rm = TRUE),
    ì´_ê¸‰ì‹_ì‹œì¥ = sum(ê¸‰ì‹_ì´ì•¡, na.rm = TRUE),
    ì´_ê¸‰ì‹_ì¤‘ëŸ‰ = sum(ê¸‰ì‹_ì´ì¤‘ëŸ‰, na.rm = TRUE)
  ) %>%
  mutate(
    ì „ì²´_ì‹œì¥ = ì´_ì†Œë§¤_ì‹œì¥ + ì´_ê¸‰ì‹_ì‹œì¥,
    ì†Œë§¤_ë¹„ì¤‘ = percent(ì´_ì†Œë§¤_ì‹œì¥ / ì „ì²´_ì‹œì¥),
    ê¸‰ì‹_ë¹„ì¤‘ = percent(ì´_ê¸‰ì‹_ì‹œì¥ / ì „ì²´_ì‹œì¥),
    ê¸‰ì‹_í‰ê· _ë‹¨ê°€ = ì´_ê¸‰ì‹_ì‹œì¥ / ì´_ê¸‰ì‹_ì¤‘ëŸ‰
  )

cat("ğŸª ì „ì²´ ì°¹ìŒ€ ì‹œì¥ í˜„í™© (2024ë…„ ì „ì²´)\n\n")
cat("ğŸ“Š ì‹œì¥ ê·œëª¨:\n")
cat("- ì „ì²´ ì‹œì¥:", comma(total_market$ì „ì²´_ì‹œì¥), "ì›\n")
cat("- ì†Œë§¤ ì‹œì¥:", comma(total_market$ì´_ì†Œë§¤_ì‹œì¥), "ì› (", total_market$ì†Œë§¤_ë¹„ì¤‘, ")\n")
cat("- ê¸‰ì‹ ì‹œì¥:", comma(total_market$ì´_ê¸‰ì‹_ì‹œì¥), "ì› (", total_market$ê¸‰ì‹_ë¹„ì¤‘, ")\n\n")

cat("ğŸ“ˆ ê¸‰ì‹ ì‹œì¥ íŠ¹ì„±:\n")
cat("- ì´ êµ¬ë§¤ëŸ‰:", comma(total_market$ì´_ê¸‰ì‹_ì¤‘ëŸ‰), "KG\n")
cat("- í‰ê·  ë‹¨ê°€:", comma(total_market$ê¸‰ì‹_í‰ê· _ë‹¨ê°€), "ì›/KG\n\n")

# ì‹œì¥ ì˜í–¥ë ¥ ë¶„ì„
market_insights <- total_market %>%
  mutate(
    ê¸‰ì‹_ì‹œì¥_ì ìœ ìœ¨ = ì´_ê¸‰ì‹_ì‹œì¥ / ì „ì²´_ì‹œì¥ * 100,
    ì†Œë§¤_ëŒ€ë¹„_ê¸‰ì‹_ë¹„ìœ¨ = ì´_ê¸‰ì‹_ì‹œì¥ / ì´_ì†Œë§¤_ì‹œì¥ * 100
  )

cat("ğŸ’¡ ì‹œì¥ êµ¬ì¡° ì¸ì‚¬ì´íŠ¸:\n")
cat("- í•™êµê¸‰ì‹ì´ ì „ì²´ ì°¹ìŒ€ ì‹œì¥ì—ì„œ ì°¨ì§€í•˜ëŠ” ë¹„ì¤‘:", round(market_insights$ê¸‰ì‹_ì‹œì¥_ì ìœ ìœ¨, 1), "%\n")
cat("- ì†Œë§¤ì‹œì¥ ëŒ€ë¹„ ê¸‰ì‹ì‹œì¥ ê·œëª¨:", round(market_insights$ì†Œë§¤_ëŒ€ë¹„_ê¸‰ì‹_ë¹„ìœ¨, 1), "%\n")
cat("- ê¸‰ì‹ì‹œì¥ì˜ ê²½ì œì  ì˜í–¥ë ¥: ìƒë‹¹í•œ ìˆ˜ì¤€ì˜ ì‹œì¥ ì ìœ ìœ¨ ë³´ìœ \n")
```

```{r}
#| label: market-share-table
#| tbl-cap: "ìœ í†µì±„ë„ë³„ ì‹œì¥ êµ¬ì„±"
# ìœ í†µì±„ë„ë³„ ì‹œì¥ ë¶„ì„ (integrated_df ì‚¬ìš©)
channel_market <- integrated_df %>%
  group_by(ìœ í†µì±„ë„) %>%
  summarise(
    ì†Œë§¤_ì‹œì¥ = sum(ì†Œë§¤_ì´ë§¤ì¶œ, na.rm = TRUE),
    ê¸‰ì‹_ì‹œì¥ = sum(ê¸‰ì‹_ì´ê¸ˆì•¡, na.rm = TRUE),
    .groups = 'drop'
  ) %>%
  mutate(
    ì±„ë„ë³„_ì „ì²´ = ì†Œë§¤_ì‹œì¥ + ê¸‰ì‹_ì‹œì¥,
    ì†Œë§¤_ë¹„ì¤‘ = percent(ì†Œë§¤_ì‹œì¥ / ì±„ë„ë³„_ì „ì²´),
    ê¸‰ì‹_ë¹„ì¤‘ = percent(ê¸‰ì‹_ì‹œì¥ / ì±„ë„ë³„_ì „ì²´)
  ) %>%
  arrange(desc(ì±„ë„ë³„_ì „ì²´))

channel_market %>%
  mutate(
    ì†Œë§¤_ì‹œì¥ = comma(ì†Œë§¤_ì‹œì¥),
    ê¸‰ì‹_ì‹œì¥ = comma(ê¸‰ì‹_ì‹œì¥),
    ì±„ë„ë³„_ì „ì²´ = comma(ì±„ë„ë³„_ì „ì²´)
  ) %>%
  gt() %>%
  cols_width(
    ìœ í†µì±„ë„ ~ pct(20),
    ì†Œë§¤_ì‹œì¥ ~ pct(20),
    ê¸‰ì‹_ì‹œì¥ ~ pct(20),
    ì±„ë„ë³„_ì „ì²´ ~ pct(20),
    ì†Œë§¤_ë¹„ì¤‘ ~ pct(10),
    ê¸‰ì‹_ë¹„ì¤‘ ~ pct(10)
  ) %>%
  tab_options(
    table.width = pct(100)
  ) %>%
  opt_table_font(
    font = "Apple Gothic"
  ) %>%
  tab_header(title = "ìœ í†µì±„ë„ë³„ ì‹œì¥ êµ¬ì„± ë¶„ì„")
```

### ì‹œì¥ êµ¬ì¡° ì‹œê°í™” {#sec-market-visualization}

```{r}
#| label: market-pie-chart
#| fig-cap: "ì „ì²´ ì°¹ìŒ€ ì‹œì¥ êµ¬ì„±"
#| fig-width: 10
#| fig-height: 6
# ì „ì²´ ì‹œì¥ íŒŒì´ì°¨íŠ¸
market_pie_data <- data.frame(
  ì‹œì¥êµ¬ë¶„ = c("ì†Œë§¤ì‹œì¥", "í•™êµê¸‰ì‹"),
  ê¸ˆì•¡ = c(total_market$ì´_ì†Œë§¤_ì‹œì¥, total_market$ì´_ê¸‰ì‹_ì‹œì¥),
  ë¹„ì¤‘ = c(
    round(total_market$ì´_ì†Œë§¤_ì‹œì¥ / total_market$ì „ì²´_ì‹œì¥ * 100, 1),
    round(total_market$ì´_ê¸‰ì‹_ì‹œì¥ / total_market$ì „ì²´_ì‹œì¥ * 100, 1)
  )
)

ggplot(market_pie_data, aes(x = "", y = ê¸ˆì•¡, fill = ì‹œì¥êµ¬ë¶„)) +
  geom_bar(stat = "identity", width = 1) +
  coord_polar("y", start = 0) +
  geom_text(aes(label = paste0(ì‹œì¥êµ¬ë¶„, "\n", comma(ê¸ˆì•¡), "ì›\n(", ë¹„ì¤‘, "%)")),
            position = position_stack(vjust = 0.5),
            family = "Apple Gothic", size = 4) +
  scale_fill_manual(values = c("ì†Œë§¤ì‹œì¥" = "#2E86AB", "í•™êµê¸‰ì‹" = "#A23B72")) +
  labs(
    title = "2024ë…„ ì°¹ìŒ€ ì „ì²´ ì‹œì¥ êµ¬ì„±",
    subtitle = paste0("ì „ì²´ ì‹œì¥ ê·œëª¨: ", comma(total_market$ì „ì²´_ì‹œì¥), "ì›")
  ) +
  theme_void() +
  theme(
    text = element_text(family = "Apple Gothic"),
    plot.title = element_text(family = "Apple Gothic", size = 16, face = "bold", hjust = 0.5),
    plot.subtitle = element_text(family = "Apple Gothic", size = 12, hjust = 0.5),
    legend.position = "none"
  )
```

```{r}
#| label: channel-comparison-chart
#| fig-cap: "ìœ í†µì±„ë„ë³„ ì†Œë§¤ì‹œì¥ vs í•™êµê¸‰ì‹ ë¹„êµ"
#| fig-width: 12
#| fig-height: 8
# ìœ í†µì±„ë„ë³„ ë¹„êµ ë§‰ëŒ€ê·¸ë˜í”„
channel_comparison <- channel_market %>%
  select(ìœ í†µì±„ë„, ì†Œë§¤_ì‹œì¥, ê¸‰ì‹_ì‹œì¥) %>%
  pivot_longer(cols = c(ì†Œë§¤_ì‹œì¥, ê¸‰ì‹_ì‹œì¥),
               names_to = "ì‹œì¥ìœ í˜•",
               values_to = "ê¸ˆì•¡") %>%
  mutate(
    ì‹œì¥ìœ í˜• = case_when(
      ì‹œì¥ìœ í˜• == "ì†Œë§¤_ì‹œì¥" ~ "ì¼ë°˜ ì†Œë§¤ì‹œì¥",
      ì‹œì¥ìœ í˜• == "ê¸‰ì‹_ì‹œì¥" ~ "í•™êµê¸‰ì‹"
    )
  )

ggplot(channel_comparison, aes(x = reorder(ìœ í†µì±„ë„, ê¸ˆì•¡), y = ê¸ˆì•¡, fill = ì‹œì¥ìœ í˜•)) +
  geom_col(position = "dodge", alpha = 0.8) +
  scale_y_continuous(labels = comma_format(scale = 1e-6, suffix = "M")) +
  scale_fill_manual(values = c("ì¼ë°˜ ì†Œë§¤ì‹œì¥" = "#2E86AB", "í•™êµê¸‰ì‹" = "#A23B72")) +
  coord_flip() +
  labs(
    title = "ìœ í†µì±„ë„ë³„ ì‹œì¥ ê·œëª¨ ë¹„êµ",
    subtitle = "2024ë…„ ì°¹ìŒ€ ì‹œì¥ (ë‹¨ìœ„: ë°±ë§Œì›)",
    x = "ìœ í†µì±„ë„",
    y = "ë§¤ì¶œì•¡ (ë°±ë§Œì›)",
    fill = "ì‹œì¥ ìœ í˜•"
  ) +
  theme_minimal() +
  theme(
    text = element_text(family = "Apple Gothic"),
    plot.title = element_text(family = "Apple Gothic", size = 14, face = "bold"),
    plot.subtitle = element_text(family = "Apple Gothic", size = 12),
    axis.text = element_text(family = "Apple Gothic"),
    axis.title = element_text(family = "Apple Gothic"),
    legend.text = element_text(family = "Apple Gothic"),
    legend.title = element_text(family = "Apple Gothic"),
    legend.position = "bottom"
  )
```

# 4ë¶€. í•™êµê¸‰ë³„ ì„¸ë¶€ ë¶„ì„ {#sec-part4-school-detailed}

## í•™êµê¸‰ë³„ ì¡°ë‹¬ íŒ¨í„´ ë¶„ì„ {#sec-school-type-analysis}

### ìœ ì¹˜ì›ë¶€í„° ê³ ë“±í•™êµê¹Œì§€ ì¡°ë‹¬ íŠ¹ì„± {#sec-school-procurement-characteristics}

```{r}
#| label: school-type-analysis
#| warning: false
# í•™êµê¸‰ë³„ ì„¸ë¶€ ë¶„ì„ (school_df ì‚¬ìš©)
school_type_data <- school_df %>%
  select(starts_with("KG_"), starts_with("ì›_"), ìœ í†µì±„ë„, ê´‘ì—­ì‹œë„, ë‚ ì§œ) %>%
  pivot_longer(
    cols = c(starts_with("KG_"), starts_with("ì›_")),
    names_to = "ë³€ìˆ˜ëª…",
    values_to = "ê°’"
  ) %>%
  filter(!is.na(ê°’), ê°’ > 0) %>%
  separate(ë³€ìˆ˜ëª…, into = c("ë‹¨ìœ„", "í•™êµê¸‰"), sep = "_", extra = "merge") %>%
  mutate(
    í•™êµê¸‰ = case_when(
      í•™êµê¸‰ == "ìœ ì¹˜ì›" ~ "ìœ ì¹˜ì›",
      í•™êµê¸‰ == "ì´ˆë“±í•™êµ" ~ "ì´ˆë“±í•™êµ",
      str_detect(í•™êµê¸‰, "ì¤‘í•™êµ") ~ "ì¤‘í•™êµ",
      str_detect(í•™êµê¸‰, "ê³ ë“±í•™êµ") ~ "ê³ ë“±í•™êµ"
    )
  ) %>%
  filter(!is.na(í•™êµê¸‰))

# í•™êµê¸‰ë³„ ì§‘ê³„
school_summary <- school_type_data %>%
  group_by(í•™êµê¸‰, ë‹¨ìœ„) %>%
  summarise(
    ì´í•© = sum(ê°’, na.rm = TRUE),
    í‰ê·  = mean(ê°’, na.rm = TRUE),
    ì¤‘ê°„ê°’ = median(ê°’, na.rm = TRUE),
    .groups = 'drop'
  ) %>%
  pivot_wider(
    names_from = ë‹¨ìœ„,
    values_from = c(ì´í•©, í‰ê· , ì¤‘ê°„ê°’)
  ) %>%
  mutate(
    í‰ê· ë‹¨ê°€ = ì´í•©_ì› / ì´í•©_KG
  ) %>%
  arrange(í‰ê· ë‹¨ê°€)

cat("ğŸ« í•™êµê¸‰ë³„ ì¡°ë‹¬ í˜„í™© ë¶„ì„\n\n")
for(i in 1:nrow(school_summary)) {
  cat("ğŸ“š", school_summary$í•™êµê¸‰[i], "\n")
  cat("  - ì´ ì¡°ë‹¬ëŸ‰:", comma(school_summary$ì´í•©_KG[i]), "KG\n")
  cat("  - ì´ ì¡°ë‹¬ê¸ˆì•¡:", comma(school_summary$ì´í•©_ì›[i]), "ì›\n")
  cat("  - í‰ê·  ë‹¨ê°€:", comma(school_summary$í‰ê· ë‹¨ê°€[i]), "ì›/KG\n\n")
}
```

```{r}
#| label: school-type-table
#| tbl-cap: "í•™êµê¸‰ë³„ ì¡°ë‹¬ íš¨ìœ¨ì„± ë¶„ì„"
# í•™êµê¸‰ë³„ í…Œì´ë¸”
school_summary %>%
  mutate(
    ì´í•©_KG = comma(ì´í•©_KG),
    ì´í•©_ì› = comma(ì´í•©_ì›),
    í‰ê· ë‹¨ê°€ = comma(í‰ê· ë‹¨ê°€)
  ) %>%
  select(í•™êµê¸‰, ì´í•©_KG, ì´í•©_ì›, í‰ê· ë‹¨ê°€) %>%
  gt() %>%
  cols_width(
    í•™êµê¸‰ ~ pct(30),
    ì´í•©_KG ~ pct(25),
    ì´í•©_ì› ~ pct(25),
    í‰ê· ë‹¨ê°€ ~ pct(20)
  ) %>%
  tab_options(
    table.width = pct(80)
  ) %>%
  opt_table_font(
    font = "Apple Gothic"
  ) %>%
  tab_header(title = "í•™êµê¸‰ë³„ ì¡°ë‹¬ íš¨ìœ¨ì„± ë¹„êµ")
```

```{r}
#| label: channel-visualization
#| fig-cap: "ìœ í†µì±„ë„ë³„ ë‹¨ê°€(ì›/KG) ë¶„í¬"
#| fig-width: 10
#| fig-height: 6
# ìœ í†µì±„ë„ë³„ ë‹¨ê°€ ë¶„í¬ ì‹œê°í™”
ggplot(school_df, aes(x = reorder(ìœ í†µì±„ë„, ë‹¨ê°€_ì›_per_KG), y = ë‹¨ê°€_ì›_per_KG)) +
  geom_boxplot(aes(fill = ìœ í†µì±„ë„), alpha = 0.7) +
  scale_y_continuous(labels = comma_format()) +
  labs(
    title = "ìœ í†µì±„ë„ë³„ ë‹¨ê°€(ì›/KG) ë¶„í¬",
    subtitle = "í•™êµê¸‰ì‹ ì°¹ìŒ€ ì¡°ë‹¬ ë‹¨ê°€ ë¹„êµ (2024ë…„ 1ì›”)",
    x = "ìœ í†µì±„ë„",
    y = "ë‹¨ê°€ (ì›/KG)",
    caption = "ë°ì´í„°: ë†ì‹í’ˆ ì˜¨Â·ì˜¤í”„ë¼ì¸ ìœ í†µ í’ˆëª© íŒë§¤ ë°ì´í„°"
  ) +
  theme(
    legend.position = "none",
    axis.text.x = element_text(angle = 45, hjust = 1, family = "Apple Gothic"),
    axis.text.y = element_text(family = "Apple Gothic"),
    plot.caption = element_text(family = "Apple Gothic")
  ) +
  scale_fill_brewer(type = "qual", palette = "Set2")
```

### ì§€ì—­ë³„ ì¡°ë‹¬ íš¨ìœ¨ì„± ë¶„ì„ {#sec-school-regional-efficiency}

```{r}
#| label: regional-analysis
#| tbl-cap: "ì§€ì—­ë³„ ì¡°ë‹¬ íš¨ìœ¨ì„± ë¶„ì„"
# ì§€ì—­ë³„ íš¨ìœ¨ì„± ë¶„ì„ (school_df ì‚¬ìš©)
regional_efficiency <- school_df %>%
  group_by(ê´‘ì—­ì‹œë„) %>%
  summarise(
    ë°ì´í„°ìˆ˜ = n(),
    í‰ê· _ë‹¨ê°€ = mean(ë‹¨ê°€_ì›_per_KG, na.rm = TRUE),
    ì´_ê¸‰ì‹_KG = sum(ì´_KG, na.rm = TRUE),
    ì´_ê¸‰ì‹_ì› = sum(ì´_ì›, na.rm = TRUE),
    ì£¼ìš”_ìœ í†µì±„ë„ = names(sort(table(ìœ í†µì±„ë„), decreasing = TRUE))[1]
  ) %>%
  arrange(í‰ê· _ë‹¨ê°€)

# ìƒìœ„/í•˜ìœ„ 10ê°œ ì§€ì—­
top_bottom_regions <- bind_rows(
  regional_efficiency %>% head(5) %>% mutate(êµ¬ë¶„ = "íš¨ìœ¨ì„± ìƒìœ„ 5ê°œ ì§€ì—­"),
  regional_efficiency %>% tail(5) %>% mutate(êµ¬ë¶„ = "íš¨ìœ¨ì„± í•˜ìœ„ 5ê°œ ì§€ì—­")
)

top_bottom_regions %>%
  select(êµ¬ë¶„, ê´‘ì—­ì‹œë„, í‰ê· _ë‹¨ê°€, ì´_ê¸‰ì‹_KG, ì£¼ìš”_ìœ í†µì±„ë„) %>%
  format_numbers(c("í‰ê· _ë‹¨ê°€", "ì´_ê¸‰ì‹_KG")) %>%
  gt(groupname_col = "êµ¬ë¶„") %>%
  cols_width(
    ê´‘ì—­ì‹œë„ ~ pct(25),
    í‰ê· _ë‹¨ê°€ ~ pct(20),
    ì´_ê¸‰ì‹_KG ~ pct(25),
    ì£¼ìš”_ìœ í†µì±„ë„ ~ pct(30)
  ) %>%
  tab_options(
    table.width = pct(90)
  ) %>%
  opt_table_font(
    font = "Apple Gothic"
  ) %>%
  tab_header(title = "ì§€ì—­ë³„ ì¡°ë‹¬ íš¨ìœ¨ì„± ë¶„ì„ (ìƒìœ„/í•˜ìœ„ 5ê°œ ì§€ì—­)")
```

```{r}
#| label: regional-visualization
#| fig-cap: "ê´‘ì—­ì‹œë„ë³„ í•™êµê¸‰ì‹ ì°¹ìŒ€ í‰ê·  ë‹¨ê°€"
#| fig-width: 12
#| fig-height: 8
# ì§€ì—­ë³„ ë‹¨ê°€ ì‹œê°í™”
ggplot(regional_efficiency, aes(x = reorder(ê´‘ì—­ì‹œë„, í‰ê· _ë‹¨ê°€), y = í‰ê· _ë‹¨ê°€)) +
  geom_col(fill = "steelblue", alpha = 0.7) +
  scale_y_continuous(labels = comma_format()) +
  labs(
    title = "ê´‘ì—­ì‹œë„ë³„ í•™êµê¸‰ì‹ ì°¹ìŒ€ í‰ê·  ë‹¨ê°€",
    subtitle = "ì§€ì—­ë³„ ì¡°ë‹¬ íš¨ìœ¨ì„± ë¹„êµ (2024ë…„ 1ì›”)",
    x = "ê´‘ì—­ì‹œë„",
    y = "í‰ê·  ë‹¨ê°€ (ì›/KG)",
    caption = "ë°ì´í„°: ë†ì‹í’ˆ ì˜¨Â·ì˜¤í”„ë¼ì¸ ìœ í†µ í’ˆëª© íŒë§¤ ë°ì´í„°"
  ) +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1, family = "Apple Gothic"),
    axis.text.y = element_text(family = "Apple Gothic"),
    plot.caption = element_text(family = "Apple Gothic")
  )
```

### í•™êµê¸‰ë³„ ì†Œë¹„ íŒ¨í„´ ë¶„ì„ {#sec-school-level-analysis}

```{r}
#| label: school-level-analysis
#| tbl-cap: "í•™êµê¸‰ë³„ ê¸‰ì‹ ì¡°ë‹¬ íš¨ìœ¨ì„±"
# í•™êµê¸‰ë³„ ë°ì´í„°ë¥¼ ê°„ë‹¨í•˜ê²Œ ì§‘ê³„ (school_df ì‚¬ìš©)
school_level_summary <- school_df %>%
  mutate(
    # ê° í•™êµê¸‰ë³„ ì´í•© ê³„ì‚° (ì´ë¯¸ school_dfì—ëŠ” ê²°ì¸¡ê°’ì´ 0ìœ¼ë¡œ ì²˜ë¦¬ë¨)
    ìœ ì¹˜ì›_ì´_KG = KG_ìœ ì¹˜ì›,
    ìœ ì¹˜ì›_ì´_ì› = ì›_ìœ ì¹˜ì›,
    ì´ˆë“±í•™êµ_ì´_KG = KG_ì´ˆë“±í•™êµ,
    ì´ˆë“±í•™êµ_ì´_ì› = ì›_ì´ˆë“±í•™êµ,
    ì¤‘í•™êµ_ì´_KG = KG_ì¤‘í•™êµ_ë…€ + KG_ì¤‘í•™êµ_ë‚¨ + KG_ì¤‘í•™êµ_ë‚¨ë…€ê³µí•™,
    ì¤‘í•™êµ_ì´_ì› = ì›_ì¤‘í•™êµ_ë…€ + ì›_ì¤‘í•™êµ_ë‚¨ + ì›_ì¤‘í•™êµ_ë‚¨ë…€ê³µí•™,
    ê³ ë“±í•™êµ_ì´_KG = KG_ê³ ë“±í•™êµ_ë…€ + KG_ê³ ë“±í•™êµ_ë‚¨ + KG_ê³ ë“±í•™êµ_ë‚¨ë…€ê³µí•™,
    ê³ ë“±í•™êµ_ì´_ì› = ì›_ê³ ë“±í•™êµ_ë…€ + ì›_ê³ ë“±í•™êµ_ë‚¨ + ì›_ê³ ë“±í•™êµ_ë‚¨ë…€ê³µí•™
  )

# í•™êµê¸‰ë³„ ì§‘ê³„
school_efficiency <- school_level_summary %>%
  summarise(
    ìœ ì¹˜ì›_í‰ê· ë‹¨ê°€ = ifelse(sum(ìœ ì¹˜ì›_ì´_KG) > 0, sum(ìœ ì¹˜ì›_ì´_ì›) / sum(ìœ ì¹˜ì›_ì´_KG), NA),
    ì´ˆë“±í•™êµ_í‰ê· ë‹¨ê°€ = ifelse(sum(ì´ˆë“±í•™êµ_ì´_KG) > 0, sum(ì´ˆë“±í•™êµ_ì´_ì›) / sum(ì´ˆë“±í•™êµ_ì´_KG), NA),
    ì¤‘í•™êµ_í‰ê· ë‹¨ê°€ = ifelse(sum(ì¤‘í•™êµ_ì´_KG) > 0, sum(ì¤‘í•™êµ_ì´_ì›) / sum(ì¤‘í•™êµ_ì´_KG), NA),
    ê³ ë“±í•™êµ_í‰ê· ë‹¨ê°€ = ifelse(sum(ê³ ë“±í•™êµ_ì´_KG) > 0, sum(ê³ ë“±í•™êµ_ì´_ì›) / sum(ê³ ë“±í•™êµ_ì´_KG), NA),
    ìœ ì¹˜ì›_ì´_KG = sum(ìœ ì¹˜ì›_ì´_KG),
    ì´ˆë“±í•™êµ_ì´_KG = sum(ì´ˆë“±í•™êµ_ì´_KG),
    ì¤‘í•™êµ_ì´_KG = sum(ì¤‘í•™êµ_ì´_KG),
    ê³ ë“±í•™êµ_ì´_KG = sum(ê³ ë“±í•™êµ_ì´_KG)
  ) %>%
  pivot_longer(
    cols = everything(),
    names_to = "í•­ëª©",
    values_to = "ê°’"
  ) %>%
  separate(í•­ëª©, into = c("í•™êµê¸‰", "ì§€í‘œ"), sep = "_", extra = "merge") %>%
  pivot_wider(names_from = ì§€í‘œ, values_from = ê°’) %>%
  filter(!is.na(í‰ê· ë‹¨ê°€), í‰ê· ë‹¨ê°€ > 0) %>%
  arrange(í‰ê· ë‹¨ê°€)

school_efficiency %>%
  format_numbers(c("í‰ê· ë‹¨ê°€", "ì´_KG")) %>%
  gt() %>%
  cols_width(
    í•™êµê¸‰ ~ pct(30),
    í‰ê· ë‹¨ê°€ ~ pct(35),
    ì´_KG ~ pct(35)
  ) %>%
  tab_options(
    table.width = pct(70)
  ) %>%
  opt_table_font(
    font = "Apple Gothic"
  ) %>%
  tab_header(title = "í•™êµê¸‰ë³„ ê¸‰ì‹ ì¡°ë‹¬ íš¨ìœ¨ì„±")
```

```{r}
#| label: school-level-visualization
#| fig-cap: "í•™êµê¸‰ë³„ í‰ê·  ë‹¨ê°€ ë¹„êµ"
#| fig-width: 8
#| fig-height: 6
# í•™êµê¸‰ë³„ ë‹¨ê°€ ë¶„í¬ (ë§‰ëŒ€ê·¸ë˜í”„)
ggplot(school_efficiency, aes(x = reorder(í•™êµê¸‰, í‰ê· ë‹¨ê°€), y = í‰ê· ë‹¨ê°€)) +
  geom_col(aes(fill = í•™êµê¸‰), alpha = 0.7) +
  geom_text(aes(label = comma(í‰ê· ë‹¨ê°€)), vjust = -0.5, family = "Apple Gothic", size = 3) +
  scale_y_continuous(labels = comma_format()) +
  labs(
    title = "í•™êµê¸‰ë³„ í‰ê·  ë‹¨ê°€ ë¹„êµ",
    subtitle = "ìœ ì¹˜ì›ë¶€í„° ê³ ë“±í•™êµê¹Œì§€ ê¸‰ì‹ ì¡°ë‹¬ ë¹„ìš© ë¹„êµ",
    x = "í•™êµê¸‰",
    y = "í‰ê·  ë‹¨ê°€ (ì›/KG)",
    caption = "ë°ì´í„°: ë†ì‹í’ˆ ì˜¨Â·ì˜¤í”„ë¼ì¸ ìœ í†µ í’ˆëª© íŒë§¤ ë°ì´í„°"
  ) +
  theme(
    legend.position = "none",
    axis.text.x = element_text(angle = 45, hjust = 1, family = "Apple Gothic"),
    axis.text.y = element_text(family = "Apple Gothic"),
    plot.caption = element_text(family = "Apple Gothic")
  ) +
  scale_fill_brewer(type = "qual", palette = "Set3")
```

### ì¢…í•© íš¨ìœ¨ì„± ë¶„ì„ {#sec-school-comprehensive-analysis}

```{r}
#| label: comprehensive-analysis
#| tbl-cap: "ìœ í†µì±„ë„ë³„ ë‹¨ê°€ ìš”ì•½ í†µê³„"
# ìœ í†µì±„ë„ë³„, ì§€ì—­ë³„ êµì°¨ ë¶„ì„ (school_df ì‚¬ìš©)
cross_analysis <- school_df %>%
  group_by(ìœ í†µì±„ë„, ê´‘ì—­ì‹œë„) %>%
  summarise(
    í‰ê· _ë‹¨ê°€ = mean(ë‹¨ê°€_ì›_per_KG, na.rm = TRUE),
    ì´_ê¸‰ì‹ëŸ‰ = sum(ì´_KG, na.rm = TRUE),
    .groups = "drop"
  ) %>%
  filter(ì´_ê¸‰ì‹ëŸ‰ > 0)

# íˆíŠ¸ë§µ ë°ì´í„° ì¤€ë¹„
heatmap_data <- cross_analysis %>%
  select(ìœ í†µì±„ë„, ê´‘ì—­ì‹œë„, í‰ê· _ë‹¨ê°€) %>%
  pivot_wider(names_from = ê´‘ì—­ì‹œë„, values_from = í‰ê· _ë‹¨ê°€, values_fill = NA)

cat("ğŸ“Š ìœ í†µì±„ë„ë³„ í‰ê·  ë‹¨ê°€ ìš”ì•½\n")
channel_summary_stats <- school_df %>%
  group_by(ìœ í†µì±„ë„) %>%
  summarise(
    ìµœì €_ë‹¨ê°€ = min(ë‹¨ê°€_ì›_per_KG, na.rm = TRUE),
    í‰ê· _ë‹¨ê°€ = mean(ë‹¨ê°€_ì›_per_KG, na.rm = TRUE),
    ìµœê³ _ë‹¨ê°€ = max(ë‹¨ê°€_ì›_per_KG, na.rm = TRUE),
    .groups = "drop"
  ) %>%
  arrange(í‰ê· _ë‹¨ê°€)

channel_summary_stats %>%
  format_numbers() %>%
  gt() %>%
  cols_width(
    ìœ í†µì±„ë„ ~ pct(25),
    ìµœì €_ë‹¨ê°€ ~ pct(25),
    í‰ê· _ë‹¨ê°€ ~ pct(25),
    ìµœê³ _ë‹¨ê°€ ~ pct(25)
  ) %>%
  tab_options(
    table.width = pct(85)
  ) %>%
  opt_table_font(
    font = "Apple Gothic"
  ) %>%
  tab_header(title = "ìœ í†µì±„ë„ë³„ ë‹¨ê°€ ìš”ì•½ í†µê³„")
```

# 5ë¶€. ì¢…í•© ì¸ì‚¬ì´íŠ¸ ë° ì •ì±… ì œì–¸ {#sec-part5-insights}

## ë°ì´í„° ê¸°ë°˜ í•µì‹¬ ë°œê²¬ì‚¬í•­ {#sec-key-findings}

### í•µì‹¬ ë°œê²¬ì‚¬í•­ {#sec-school-key-findings}

```{r}
#| label: key-findings
#| echo: false
# ì£¼ìš” ë°œê²¬ì‚¬í•­ ê³„ì‚°ì„ ìœ„í•œ ë°ì´í„° ì¤€ë¹„
channel_efficiency <- school_df %>%
  group_by(ìœ í†µì±„ë„) %>%
  summarise(
    í‰ê· _ë‹¨ê°€ = mean(ë‹¨ê°€_ì›_per_KG, na.rm = TRUE),
    .groups = 'drop'
  ) %>%
  arrange(í‰ê· _ë‹¨ê°€)

regional_efficiency <- school_df %>%
  group_by(ê´‘ì—­ì‹œë„) %>%
  summarise(
    í‰ê· _ë‹¨ê°€ = mean(ë‹¨ê°€_ì›_per_KG, na.rm = TRUE),
    .groups = 'drop'
  ) %>%
  arrange(í‰ê· _ë‹¨ê°€)

# ì£¼ìš” ë°œê²¬ì‚¬í•­ ê³„ì‚°
most_efficient_channel <- channel_efficiency$ìœ í†µì±„ë„[1]
least_efficient_channel <- channel_efficiency$ìœ í†µì±„ë„[nrow(channel_efficiency)]
price_difference <- channel_efficiency$í‰ê· _ë‹¨ê°€[nrow(channel_efficiency)] - channel_efficiency$í‰ê· _ë‹¨ê°€[1]

most_efficient_region <- regional_efficiency$ê´‘ì—­ì‹œë„[1]
least_efficient_region <- regional_efficiency$ê´‘ì—­ì‹œë„[nrow(regional_efficiency)]
regional_price_difference <- regional_efficiency$í‰ê· _ë‹¨ê°€[nrow(regional_efficiency)] - regional_efficiency$í‰ê· _ë‹¨ê°€[1]

# ì‹œì¥ ë¹„êµ ë¶„ì„
market_insights <- total_market %>%
  mutate(
    ê¸‰ì‹_ì‹œì¥_ì ìœ ìœ¨ = ì´_ê¸‰ì‹_ì‹œì¥ / ì „ì²´_ì‹œì¥ * 100,
    ì†Œë§¤_ëŒ€ë¹„_ê¸‰ì‹_ë¹„ìœ¨ = ì´_ê¸‰ì‹_ì‹œì¥ / ì´_ì†Œë§¤_ì‹œì¥ * 100
  )

cat("ğŸ” ì „ì²´ ì‹œì¥ ì¸ì‚¬ì´íŠ¸\n\n")
cat("ğŸ“Š ì‹œì¥ êµ¬ì¡° ë¶„ì„:\n")
cat("  - í•™êµê¸‰ì‹ ì‹œì¥ ì ìœ ìœ¨:", round(market_insights$ê¸‰ì‹_ì‹œì¥_ì ìœ ìœ¨, 1), "%\n")
cat("  - ì†Œë§¤ì‹œì¥ ëŒ€ë¹„ ê¸‰ì‹ì‹œì¥ ë¹„ìœ¨:", round(market_insights$ì†Œë§¤_ëŒ€ë¹„_ê¸‰ì‹_ë¹„ìœ¨, 1), "%\n")
cat("  - ê¸‰ì‹ì‹œì¥ í‰ê·  ë‹¨ê°€:", comma(round(market_insights$ê¸‰ì‹_í‰ê· _ë‹¨ê°€)), "ì›/KG\n\n")

cat("ğŸ“Œ ìœ í†µì±„ë„ íš¨ìœ¨ì„±:\n")
cat("  - ê°€ì¥ íš¨ìœ¨ì :", most_efficient_channel, "\n")
cat("  - ê°€ì¥ ë¹„íš¨ìœ¨ì :", least_efficient_channel, "\n")
cat("  - ì±„ë„ ê°„ ë‹¨ê°€ ì°¨ì´:", comma(price_difference), "ì›/KG\n\n")

cat("ğŸ“Œ ì§€ì—­ë³„ íš¨ìœ¨ì„±:\n")
cat("  - ê°€ì¥ íš¨ìœ¨ì :", most_efficient_region, "\n")
cat("  - ê°€ì¥ ë¹„íš¨ìœ¨ì :", least_efficient_region, "\n")
cat("  - ì§€ì—­ ê°„ ë‹¨ê°€ ì°¨ì´:", comma(regional_price_difference), "ì›/KG\n\n")

# ì ì¬ì  ì ˆì•½ íš¨ê³¼ ê³„ì‚°
total_kg <- sum(school_df$ì´_KG, na.rm = TRUE)
current_avg_price <- mean(school_df$ë‹¨ê°€_ì›_per_KG, na.rm = TRUE)
best_price <- min(school_df$ë‹¨ê°€_ì›_per_KG, na.rm = TRUE)
potential_savings <- (current_avg_price - best_price) * total_kg

cat("ğŸ’° ì ì¬ì  ì ˆì•½ íš¨ê³¼:\n")
cat("  - í˜„ì¬ í‰ê·  ë‹¨ê°€:", comma(current_avg_price), "ì›/KG\n")
cat("  - ìµœì  ë‹¨ê°€:", comma(best_price), "ì›/KG\n")
cat("  - ì›”ê°„ ì ì¬ ì ˆì•½ì•¡:", comma(potential_savings), "ì›\n")
cat("  - ì—°ê°„ ì ì¬ ì ˆì•½ì•¡:", comma(potential_savings * 12), "ì›\n\n")

# ì‹œì¥ ì˜í–¥ë ¥ ë¶„ì„
cat("ğŸ¢ ì‹œì¥ ì˜í–¥ë ¥ ë¶„ì„:\n")
cat("  - í•™êµê¸‰ì‹ì´ ì „ì²´ ì°¹ìŒ€ ì‹œì¥ì—ì„œ ì°¨ì§€í•˜ëŠ” ë¹„ì¤‘ì´", round(market_insights$ê¸‰ì‹_ì‹œì¥_ì ìœ ìœ¨, 1), "%ë¡œ,\n")
cat("    ìƒë‹¹í•œ ê²½ì œì  ì˜í–¥ë ¥ì„ ê°€ì§€ê³  ìˆìŒ\n")
cat("  - ê¸‰ì‹ ì¡°ë‹¬ íš¨ìœ¨í™”ë¥¼ í†µí•œ ì‹œì¥ ì „ì²´ì˜ ê°€ê²© ì•ˆì •í™” ê°€ëŠ¥\n")
```

### ğŸ¯ 3ê°œ ì˜ì—­ í†µí•© í•´ê²°ë°©ì•ˆ {#sec-integrated-solutions}

ë³¸ ë¶„ì„ì„ í†µí•´ ë„ì¶œëœ í•´ê²°ë°©ì•ˆì„ **ë¹„ìš© íš¨ìœ¨í™”**, **ì œë„ ê°œì„ **, **ì‹¤í–‰ ë°©ì•ˆ**ì˜ 3ê°œ ì˜ì—­ìœ¼ë¡œ êµ¬ì¡°í™”í•˜ì—¬ ì œì‹œí•©ë‹ˆë‹¤.

#### **ì˜ì—­ 1: ë¹„ìš© íš¨ìœ¨í™” ì „ëµ** {#sec-cost-efficiency}

```{r}
#| label: cost-efficiency-strategy
#| echo: false
cat("ğŸ’° ë¹„ìš© íš¨ìœ¨í™” í•µì‹¬ ì „ëµ\n\n")

cat("ã€ìµœì  ìœ í†µì±„ë„ í™œìš©ã€‘\n")
cat("âœ… ê¶Œì¥ ì¡°ë‹¬ ìˆœì„œ:\n")
for(i in 1:nrow(channel_efficiency)) {
  cat(sprintf("  %dìˆœìœ„: %s (í‰ê·  ë‹¨ê°€: %sì›/KG)\n",
              i,
              channel_efficiency$ìœ í†µì±„ë„[i],
              comma(channel_efficiency$í‰ê· _ë‹¨ê°€[i])))
}

cat("\nã€ì§€ì—­ë³„ ì¡°ë‹¬ ì „ëµã€‘\n")
efficient_regions <- regional_efficiency %>% head(5) %>% pull(ê´‘ì—­ì‹œë„)
inefficient_regions <- regional_efficiency %>% tail(5) %>% pull(ê´‘ì—­ì‹œë„)

cat("ğŸŒŸ íš¨ìœ¨ì„± ìš°ìˆ˜ ì§€ì—­ (ë²¤ì¹˜ë§ˆí‚¹):\n")
cat("  ", paste(efficient_regions, collapse = ", "), "\n")
cat("âš ï¸ ê°œì„  í•„ìš” ì§€ì—­ (ì§‘ì¤‘ ì§€ì›):\n")
cat("  ", paste(inefficient_regions, collapse = ", "), "\n")

cat("\nã€ê°€ê²© ìµœì í™” ë°©ì•ˆã€‘\n")
cat("  - ì‹ìì¬ë§ˆíŠ¸ ìš°ì„  í™œìš©ìœ¼ë¡œ", comma(price_difference), "ì›/KG ì ˆì•½ ê°€ëŠ¥\n")
cat("  - ì§€ì—­ë³„ ê²©ì°¨ í•´ì†Œë¡œ ìµœëŒ€", comma(regional_price_difference), "ì›/KG ì ˆì•½\n")
cat("  - ì—°ê°„ ì ì¬ ì ˆì•½ì•¡:", comma(potential_savings * 12), "ì›\n")
```

#### **ì˜ì—­ 2: ì œë„ ê°œì„  ë°©ì•ˆ** {#sec-institutional-reform}

```{r}
#| label: institutional-reform-strategy
#| echo: false
cat("ğŸ›ï¸ ì œë„ ê°œì„  í•µì‹¬ ë°©ì•ˆ\n\n")

cat("ã€ì¡°ë‹¬ ì‹œìŠ¤í…œ ê°œì„ ã€‘\n")
cat("  - í•™êµê¸‰ì‹ë²• ê°œì •: ê³µë™êµ¬ë§¤ ì˜ë¬´í™” ì¡°í•­ ì‹ ì„¤\n")
cat("  - ì¡°ë‹¬ì²­-êµìœ¡ë¶€ ì—°ê³„ í†µí•© êµ¬ë§¤ ì‹œìŠ¤í…œ êµ¬ì¶•\n")
cat("  - ë””ì§€í„¸ í”Œë«í¼ ê¸°ë°˜ íˆ¬ëª…í•œ ì…ì°° ì‹œìŠ¤í…œ\n")
cat("  - ë¸”ë¡ì²´ì¸ í™œìš© ê±°ë˜ íˆ¬ëª…ì„± í™•ë³´\n\n")

cat("ã€ì§€ì—­ ê²©ì°¨ í•´ì†Œã€‘\n")
cat("  - ì§€ì—­ë³„ ê¸‰ì‹ë¹„ ì°¨ë“± ì§€ì› í™•ëŒ€\n")
cat("  - ë†ì–´ì´Œ ì§€ì—­ ì¡°ë‹¬ë¹„ ì¶”ê°€ ì§€ì›\n")
cat("  - ê³µë™ ë¬¼ë¥˜ì„¼í„° êµ¬ì¶•ì„ í†µí•œ ìœ í†µë¹„ìš© ì ˆê°\n")
cat("  - ì§€ì—­ë³„ ê¸‰ì‹ì„¼í„°ì™€ ë¡œì»¬í‘¸ë“œ ì—°ê³„ ê°•í™”\n\n")

cat("ã€ì •ì±… ì œì–¸ã€‘\n")
cat("  - ê¸‰ì‹ë¹„ í˜„ì‹¤í™”: ë¬¼ê°€ ì—°ë™ ìë™ ì¡°ì • ë©”ì»¤ë‹ˆì¦˜\n")
cat("  - íš¨ìœ¨ì„± ê°œì„  ì¸ì„¼í‹°ë¸Œ: ì ˆì•½ë¶„ì˜ 50% êµìœ¡ì²­ í™˜ì›\n")
cat("  - ì •ê¸°ì ì¸ ìœ í†µì—…ì²´ í‰ê°€ ë° ë“±ê¸‰ì œ ë„ì…\n")
cat("  - ê°€ê²©-í’ˆì§ˆ í†µí•© í‰ê°€ ê¸°ì¤€ ë§ˆë ¨\n")
```

#### **ì˜ì—­ 3: ì‹¤í–‰ ë°©ì•ˆ** {#sec-implementation-plan}

```{r}
#| label: implementation-strategy
#| echo: false
cat("ğŸš€ ë‹¨ê³„ì  ì‹¤í–‰ ë°©ì•ˆ\n\n")

cat("ã€1ë‹¨ê³„: ì¦‰ì‹œ ì‹¤í–‰ (1-3ê°œì›”)ã€‘\n")
cat("âœ… ìœ í†µì±„ë„ë³„ ë‹¨ê°€ DB êµ¬ì¶• ë° ëª¨ë‹ˆí„°ë§ ì‹œìŠ¤í…œ\n")
cat("âœ… íš¨ìœ¨ì„± ìš°ìˆ˜ ì§€ì—­ ì‚¬ë¡€ ì¡°ì‚¬ ë° ë²¤ì¹˜ë§ˆí‚¹\n")
cat("âœ… ìµœì  ì¡°ë‹¬ ìˆœì„œ ê°€ì´ë“œë¼ì¸ ë°°í¬\n")
cat("âœ… ê³µë™êµ¬ë§¤ ì‹œë²” ì‚¬ì—… 5ê°œ êµìœ¡ì²­ ì„ ì •\n\n")

cat("ã€2ë‹¨ê³„: ì‹œë²” ìš´ì˜ (3-6ê°œì›”)ã€‘\n")
cat("ğŸ”„ í†µí•© ì¡°ë‹¬ í”Œë«í¼ íŒŒì¼ëŸ¿ ìš´ì˜\n")
cat("ğŸ”„ ì˜¨ë¼ì¸ ì§ê±°ë˜ ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸\n")
cat("ğŸ”„ ì§€ì—­ë³„ ì¡°ë‹¬ íš¨ìœ¨ì„± ê°œì„  í”„ë¡œê·¸ë¨\n")
cat("ğŸ”„ AI ê¸°ë°˜ ê°€ê²© ì˜ˆì¸¡ ì‹œìŠ¤í…œ ê°œë°œ\n\n")

cat("ã€3ë‹¨ê³„: ì „ë©´ í™•ì‚° (6-12ê°œì›”)ã€‘\n")
cat("ğŸš€ ì „êµ­ êµìœ¡ì²­ í†µí•© ì¡°ë‹¬ ì‹œìŠ¤í…œ êµ¬ì¶•\n")
cat("ğŸš€ í’ˆì§ˆ-ê°€ê²© í†µí•© í‰ê°€ ì‹œìŠ¤í…œ ì „ë©´ ë„ì…\n")
cat("ğŸš€ ì„±ê³¼ ì¸¡ì • ë° ì§€ì† ê°œì„  ì²´ê³„ í™•ë¦½\n")
cat("ğŸš€ ë‹¤ë¥¸ ì‹ì¬ë£Œ í’ˆëª©ìœ¼ë¡œ í™•ì¥ ì ìš©\n")
```

#### **ì„±ê³¼ ì¸¡ì • ë° ì§€ì† ê°œì„ ** {#sec-performance-measurement}

```{r}
#| label: performance-measurement-strategy
#| echo: false
cat("ğŸ“Š ì„±ê³¼ ì¸¡ì • ë° ì§€ì† ê°œì„  ì²´ê³„\n\n")

# ì˜ˆìƒ ì ˆì•½ íš¨ê³¼ ê³„ì‚°
annual_savings <- potential_savings * 12
cat("ã€í•µì‹¬ ì„±ê³¼ ì§€í‘œ (KPI)ã€‘\n")
cat("ğŸ’° ì˜ˆìƒ ì—°ê°„ ì ˆì•½ íš¨ê³¼:\n")
cat("  - ì§ì ‘ ë¹„ìš© ì ˆê°:", comma(annual_savings), "ì›\n")
cat("  - í–‰ì • ë¹„ìš© ì ˆê°:", comma(annual_savings * 0.2), "ì› (20%)\n")
cat("  - ì´ ì ˆì•½ íš¨ê³¼:", comma(annual_savings * 1.2), "ì›\n\n")

cat("ğŸ“ˆ ì§€ì† ê°œì„  ì§€í‘œ:\n")
cat("  - ìœ í†µì±„ë„ë³„ ë‹¨ê°€ ê°œì„ ìœ¨\n")
cat("  - ì§€ì—­ë³„ ì¡°ë‹¬ ê²©ì°¨ ì¶•ì†Œìœ¨\n")
cat("  - ê³µë™êµ¬ë§¤ ì°¸ì—¬ êµìœ¡ì²­ ë¹„ìœ¨\n")
cat("  - ê¸‰ì‹ ë§Œì¡±ë„ ê°œì„  ì ìˆ˜\n\n")

cat("ã€ëª¨ë‹ˆí„°ë§ ì²´ê³„ã€‘\n")
cat("  - ì›”ë³„ ì¡°ë‹¬ í˜„í™© ëŒ€ì‹œë³´ë“œ ìš´ì˜\n")
cat("  - ë¶„ê¸°ë³„ íš¨ìœ¨ì„± í‰ê°€ ë° ìˆœìœ„ ë°œí‘œ\n")
cat("  - ì—°ê°„ ìš°ìˆ˜ ì‚¬ë¡€ ë°œêµ´ ë° í¬ìƒ\n")
cat("  - ì§€ì†ì ì¸ ë°ì´í„° ìˆ˜ì§‘ ë° ë¶„ì„\n")
```

### ğŸ“ˆ ì‹œì¥ í†µí•© ê¸°ë°˜ íš¨ê³¼ ê·¹ëŒ€í™” ì „ëµ {#sec-market-integration-strategy}

ì†Œë§¤ì‹œì¥ê³¼ ê¸‰ì‹ì‹œì¥ì˜ êµ¬ì¡°ì  ì—°ê³„ë¥¼ í†µí•œ ì‹œë„ˆì§€ ì°½ì¶œ ë°©ì•ˆì„ ì œì‹œí•©ë‹ˆë‹¤.

```{r}
#| label: market-integration-strategy
#| echo: false
cat("ğŸ”„ ì‹œì¥ í†µí•© ì „ëµ\n\n")

cat("ã€ì†Œë§¤-ê¸‰ì‹ ì‹œì¥ ì—°ê³„ ê°•í™”ã€‘\n")
cat("ğŸ“Š í˜„ì¬ ì‹œì¥ êµ¬ì¡°:\n")
cat("  - ê¸‰ì‹ ì‹œì¥ ì ìœ ìœ¨:", round(market_insights$ê¸‰ì‹_ì‹œì¥_ì ìœ ìœ¨, 1), "%\n")
cat("  - ì†Œë§¤ ëŒ€ë¹„ ê¸‰ì‹ ë¹„ìœ¨:", round(market_insights$ì†Œë§¤_ëŒ€ë¹„_ê¸‰ì‹_ë¹„ìœ¨, 1), "%\n")
cat("  - ê¸‰ì‹ ì‹œì¥ì˜ í˜‘ìƒë ¥ í™œìš© ê°€ëŠ¥ì„± ë†’ìŒ\n\n")

cat("ğŸ”¸ ê³µë™ ë¬¼ë¥˜ ë„¤íŠ¸ì›Œí¬:\n")
cat("  - ì†Œë§¤-ê¸‰ì‹ í†µí•© ë¬¼ë¥˜ì„¼í„° êµ¬ì¶•\n")
cat("  - ê³µë™ ì¬ê³  ê´€ë¦¬ë¡œ ë¹„ìš© ì ˆê°\n")
cat("  - ë†ê°€-ì†Œë§¤-ê¸‰ì‹ ì§ê±°ë˜ í™•ëŒ€\n\n")

cat("ğŸ”¸ ê°€ê²© ì•ˆì •í™” ë©”ì»¤ë‹ˆì¦˜:\n")
cat("  - ê¸‰ì‹ ëŒ€ëŸ‰ êµ¬ë§¤ë ¥ì„ í™œìš©í•œ ê°€ê²© í˜‘ìƒ\n")
cat("  - ì†Œë§¤ê°€ê²© ëª¨ë‹ˆí„°ë§ ê¸°ë°˜ ì ì •ê°€ ì‚°ì •\n")
cat("  - ê³„ì ˆë³„ ìˆ˜ê¸‰ ì¡°ì ˆ ê³µë™ ëŒ€ì‘\n\n")

cat("ğŸ”¸ ì§€ì—­ë³„ ë§ì¶¤ ì—°ê³„:\n")
cat("  - ë†ì‚°ë¬¼ ì£¼ì‚°ì§€ì™€ ì†Œë¹„ì§€ ì§ê±°ë˜\n")
cat("  - ì§€ì—­ ê¸‰ì‹ì„¼í„°ì™€ ë¡œì»¬í‘¸ë“œ ì—°ê³„\n")
cat("  - ì¤‘ì†Œ ìœ í†µì—…ì²´ ìƒìƒ ìƒíƒœê³„ êµ¬ì¶•\n")
```

### ğŸ¯ ì •ì±… ì œì–¸ {#sec-school-policy-recommendations}

```{r}
#| label: policy-recommendations
#| echo: false
cat("ğŸ“‹ í•™êµê¸‰ì‹ ë¹„ìš© íš¨ìœ¨í™”ë¥¼ ìœ„í•œ ì •ì±… ì œì–¸\n\n")

cat("ã€ì œë„ ê°œì„ ã€‘\n")
cat("- í•™êµê¸‰ì‹ë²• ê°œì •: ê³µë™êµ¬ë§¤ ì˜ë¬´í™” ì¡°í•­ ì‹ ì„¤\n")
cat("- ì¡°ë‹¬ì²­-êµìœ¡ë¶€ ì—°ê³„ í†µí•© êµ¬ë§¤ ì‹œìŠ¤í…œ êµ¬ì¶•\n")
cat("- ì§€ì—­ë³„ ê¸‰ì‹ë¹„ ì°¨ë“± ì§€ì› í™•ëŒ€\n\n")

cat("ã€ì˜ˆì‚° ì •ì±…ã€‘\n")
cat("- ê¸‰ì‹ë¹„ í˜„ì‹¤í™”: ë¬¼ê°€ ì—°ë™ ìë™ ì¡°ì • ë©”ì»¤ë‹ˆì¦˜\n")
cat("- íš¨ìœ¨ì„± ê°œì„  ì¸ì„¼í‹°ë¸Œ: ì ˆì•½ë¶„ì˜ 50% êµìœ¡ì²­ í™˜ì›\n")
cat("- ë†ì–´ì´Œ ì§€ì—­ ì¡°ë‹¬ë¹„ ì¶”ê°€ ì§€ì›\n\n")

cat("ã€ê¸°ìˆ  í˜ì‹ ã€‘\n")
cat("- êµ­ê°€ ì°¨ì›ì˜ ê¸‰ì‹ ì¡°ë‹¬ í†µí•© í”Œë«í¼ êµ¬ì¶•\n")
cat("- ë¸”ë¡ì²´ì¸ ê¸°ë°˜ íˆ¬ëª…í•œ ê±°ë˜ ì‹œìŠ¤í…œ\n")
cat("- ë¹…ë°ì´í„° í™œìš© ìˆ˜ìš” ì˜ˆì¸¡ ì‹œìŠ¤í…œ\n\n")

cat("ã€í’ˆì§ˆ ê´€ë¦¬ã€‘\n")
cat("- ê°€ê²©-í’ˆì§ˆ í†µí•© í‰ê°€ ê¸°ì¤€ ë§ˆë ¨\n")
cat("- ì •ê¸°ì ì¸ ìœ í†µì—…ì²´ í‰ê°€ ë° ë“±ê¸‰ì œ\n")
cat("- í•™êµê¸‰ì‹ ë§Œì¡±ë„ì™€ ì—°ê³„í•œ ì„±ê³¼ ì§€í‘œ\n")
```

## ê²°ë¡ : ë°ì´í„° ê¸°ë°˜ ê¸‰ì‹ ì¡°ë‹¬ í˜ì‹  {#sec-school-conclusion}

### ğŸ¯ í•µì‹¬ ì„±ê³¼ ë° ê¸°ëŒ€ íš¨ê³¼ {#sec-key-achievements}

```{r}
#| label: conclusion-summary
#| echo: false
cat("ğŸ“Š ë¶„ì„ ê²°ê³¼ ìš”ì•½\n\n")

cat("ã€ë¬¸ì œ í•´ê²° ì„±ê³¼ã€‘\n")
cat("ğŸ” í™•ì¸ëœ í•µì‹¬ ë¬¸ì œ:\n")
cat("  âœ“ ê¸‰ì‹ ì¡°ë‹¬ ë¹„ìš© ì§€ì† ì¦ê°€ (ì „ë…„ ëŒ€ë¹„ 6% ì¸ìƒ)\n")
cat("  âœ“ ì§€ì—­ë³„ ê¸‰ì‹ë¹„ ìµœëŒ€ 708ì› ê²©ì°¨ (ì„œìš¸ vs ì „ë¶)\n")
cat("  âœ“ ìœ í†µì±„ë„ë³„ ë‹¨ê°€ ì°¨ì´", comma(price_difference), "ì›/KG\n\n")

cat("ã€ì •ëŸ‰ì  ê°œì„  íš¨ê³¼ã€‘\n")
cat("ğŸ’° ë¹„ìš© ì ˆê° ì ì¬ë ¥:\n")
cat("  - ìœ í†µì±„ë„ ìµœì í™”:", comma(price_difference), "ì›/KG ì ˆì•½\n")
cat("  - ì§€ì—­ë³„ ê²©ì°¨ í•´ì†Œ:", comma(regional_price_difference), "ì›/KG ì ˆì•½\n")
cat("  - ì—°ê°„ ì§ì ‘ ì ˆì•½:", comma(potential_savings * 12), "ì›\n")
cat("  - í–‰ì •ë¹„ìš© ì ˆê° í¬í•¨:", comma(potential_savings * 12 * 1.2), "ì›\n\n")

cat("ã€ì‹œì¥ êµ¬ì¡° ê°œì„ ã€‘\n")
cat("ğŸ”„ í†µí•© ì‹œì¥ íš¨ê³¼:\n")
cat("  - ê¸‰ì‹ ì‹œì¥ ì ìœ ìœ¨:", round(market_insights$ê¸‰ì‹_ì‹œì¥_ì ìœ ìœ¨, 1), "% í™œìš© ê°€ëŠ¥\n")
cat("  - ì†Œë§¤-ê¸‰ì‹ ì—°ê³„ë¥¼ í†µí•œ ì‹œë„ˆì§€ ì°½ì¶œ\n")
cat("  - ì§€ì—­ë³„ ë§ì¶¤í˜• ì¡°ë‹¬ ì „ëµ ìˆ˜ë¦½\n")
```

### ğŸ“ˆ ì •ì±…ì  íŒŒê¸‰ íš¨ê³¼ {#sec-policy-impact}

ë³¸ ë¶„ì„ì´ ì œì‹œí•˜ëŠ” **3ê°œ ì˜ì—­ í†µí•© í•´ê²°ë°©ì•ˆ**ì€ ë‹¤ìŒê³¼ ê°™ì€ ì •ì±…ì  íŒŒê¸‰ íš¨ê³¼ë¥¼ ê¸°ëŒ€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

```{r}
#| label: policy-impact
#| echo: false
cat("ğŸ›ï¸ ì •ì±…ì  íŒŒê¸‰ íš¨ê³¼\n\n")

cat("ã€ë¹„ìš© íš¨ìœ¨í™” ì˜ì—­ã€‘\n")
cat("  âœ“ ì „êµ­ 17ê°œ ì‹œë„êµìœ¡ì²­ ì¡°ë‹¬ ë¹„ìš© í‰ê· ", round(price_difference/1000, 1), "ì²œì›/KG ì ˆê°\n")
cat("  âœ“ íš¨ìœ¨ì„± ìš°ìˆ˜ ì§€ì—­ ëª¨ë¸ì˜ ì „êµ­ í™•ì‚°\n")
cat("  âœ“ ë°ì´í„° ê¸°ë°˜ ì˜ì‚¬ê²°ì • ì²´ê³„ êµ¬ì¶•\n\n")

cat("ã€ì œë„ ê°œì„  ì˜ì—­ã€‘\n")
cat("  âœ“ í•™êµê¸‰ì‹ë²• ê°œì •ì„ í†µí•œ ê³µë™êµ¬ë§¤ ì œë„í™”\n")
cat("  âœ“ ì§€ì—­ë³„ ê¸‰ì‹ë¹„ ê²©ì°¨ í•´ì†Œ ì •ì±… ê·¼ê±° ë§ˆë ¨\n")
cat("  âœ“ íˆ¬ëª…í•œ ì¡°ë‹¬ ì‹œìŠ¤í…œ êµ¬ì¶•\n\n")

cat("ã€ì‹¤í–‰ ì˜ì—­ã€‘\n")
cat("  âœ“ ë‹¨ê³„ì  ì‹¤í–‰ ë¡œë“œë§µ ì œì‹œ (12ê°œì›” ì™„ì„±)\n")
cat("  âœ“ ì„±ê³¼ ì¸¡ì • ì§€í‘œ ë° ëª¨ë‹ˆí„°ë§ ì²´ê³„\n")
cat("  âœ“ ë‹¤ë¥¸ ì‹ì¬ë£Œ í’ˆëª© í™•ì¥ ì ìš© ê°€ëŠ¥\n")
```

### ğŸš€ ë¯¸ë˜ ë¹„ì „ {#sec-future-vision}

ì´ëŸ¬í•œ ë°ì´í„° ê¸°ë°˜ ì ‘ê·¼ì„ í†µí•´ ë‹¬ì„± ê°€ëŠ¥í•œ **í•™êµê¸‰ì‹ í˜ì‹  ë¹„ì „**:

```{r}
#| label: future-vision
#| echo: false
cat("ğŸŒŸ 2025ë…„ í•™êµê¸‰ì‹ í˜ì‹  ë¹„ì „\n\n")

cat("ã€ë‹¨ê¸° ëª©í‘œ (1ë…„ ë‚´)ã€‘\n")
cat("  ğŸ¯ ì „êµ­ í‰ê·  ê¸‰ì‹ ì¡°ë‹¬ ë‹¨ê°€ 5% ì ˆê°\n")
cat("  ğŸ¯ ì§€ì—­ë³„ ê¸‰ì‹ë¹„ ê²©ì°¨ 30% ì¶•ì†Œ\n")
cat("  ğŸ¯ ê³µë™êµ¬ë§¤ ì°¸ì—¬ êµìœ¡ì²­ 50% ë‹¬ì„±\n\n")

cat("ã€ì¤‘ê¸° ëª©í‘œ (3ë…„ ë‚´)ã€‘\n")
cat("  ğŸš€ AI ê¸°ë°˜ ìŠ¤ë§ˆíŠ¸ ì¡°ë‹¬ ì‹œìŠ¤í…œ ì „ë©´ ë„ì…\n")
cat("  ğŸš€ í’ˆì§ˆ-ê°€ê²© í†µí•© í‰ê°€ ì‹œìŠ¤í…œ ì •ì°©\n")
cat("  ğŸš€ ì „ì²´ ì‹ì¬ë£Œ í’ˆëª© íš¨ìœ¨í™” ì™„ì„±\n\n")

cat("ã€ê¶ê·¹ì  ë¹„ì „ã€‘\n")
cat("  ğŸ’¡ ì œí•œëœ ì˜ˆì‚°ìœ¼ë¡œ ë” ë‚˜ì€ ì‹ì¬ë£Œ ì¡°ë‹¬\n")
cat("  ğŸ’¡ í•™ìƒë“¤ì˜ ê¸‰ì‹ ë§Œì¡±ë„ í–¥ìƒ\n")
cat("  ğŸ’¡ êµìœ¡ ì¬ì • ê±´ì „ì„± í™•ë³´\n")
cat("  ğŸ’¡ ì§€ì† ê°€ëŠ¥í•œ í•™êµê¸‰ì‹ ìƒíƒœê³„ êµ¬ì¶•\n")
```

---

**ë³¸ ë¶„ì„ì˜ ì˜ì˜**: 2024ë…„ ì „ì²´(12ê°œì›”) ì°¹ìŒ€ ë°ì´í„°ë¥¼ í™œìš©í•˜ì—¬ **ì†Œë§¤ì‹œì¥ê³¼ ê¸‰ì‹ì‹œì¥ì˜ í†µí•©ì  ê´€ì **ì—ì„œ ì¡°ë‹¬ íš¨ìœ¨ì„± ê°œì„  ë°©ì•ˆì„ ì œì‹œí•œ ì²« ë²ˆì§¸ ì²´ê³„ì  ì—°êµ¬ì…ë‹ˆë‹¤. í–¥í›„ ë‹¤ë¥¸ ì£¼ìš” ì‹ì¬ë£Œ í’ˆëª©ì— ëŒ€í•œ í™•ì¥ ë¶„ì„ì„ í†µí•´ **ì „ë©´ì ì¸ í•™êµê¸‰ì‹ í˜ì‹ **ì˜ í† ëŒ€ë¥¼ ë§ˆë ¨í•  ìˆ˜ ìˆì„ ê²ƒì…ë‹ˆë‹¤.